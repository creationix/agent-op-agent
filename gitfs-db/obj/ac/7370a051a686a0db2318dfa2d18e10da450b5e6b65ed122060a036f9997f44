{"type":"text","lines":["<!DOCTYPE html>","<html lang=\"en\">","<head>","  <meta charset=\"UTF-8\">","  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">","  <title>Input Logger - MIDI, Gamepad, Serial & Keyboard</title>","  <style>","    * { margin: 0; padding: 0; box-sizing: border-box; }","    ","    body {","      font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;","      background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);","      min-height: 100vh;","      color: #e0e0e0;","      padding: 20px;","    }","    ","    h1 {","      color: #10b981;","      margin-bottom: 8px;","      font-size: 1.8rem;","    }","    ","    .subtitle {","      color: #666;","      margin-bottom: 20px;","      font-size: 0.9rem;","    }","    ","    .container {","      display: grid;","      grid-template-columns: 300px 1fr;","      gap: 20px;","      max-width: 1400px;","      margin: 0 auto;","    }","    ","    @media (max-width: 900px) {","      .container { grid-template-columns: 1fr; }","    }","    ","    .sidebar {","      display: flex;","      flex-direction: column;","      gap: 12px;","    }","    ","    .panel {","      background: rgba(255,255,255,0.03);","      border: 1px solid rgba(255,255,255,0.1);","      border-radius: 12px;","      padding: 14px;","    }","    ","    .panel h2 {","      font-size: 0.75rem;","      text-transform: uppercase;","      letter-spacing: 1px;","      color: #888;","      margin-bottom: 10px;","      display: flex;","      align-items: center;","      gap: 8px;","    }","    ","    .panel h2 .icon { font-size: 1rem; }","    ","    .device-list {","      display: flex;","      flex-direction: column;","      gap: 6px;","    }","    ","    .device {","      background: rgba(255,255,255,0.05);","      padding: 8px 10px;","      border-radius: 6px;","      font-size: 0.8rem;","    }","    ","    .device .name {","      color: #fff;","      font-weight: 500;","    }","    ","    .device .info {","      color: #666;","      font-size: 0.7rem;","      margin-top: 2px;","    }","    ","    .no-devices {","      color: #555;","      font-size: 0.8rem;","      font-style: italic;","    }","    ","    .status-dot {","      width: 8px;","      height: 8px;","      border-radius: 50%;","      display: inline-block;","      margin-right: 6px;","    }","    ","    .status-dot.connected { background: #10b981; }","    .status-dot.disconnected { background: #ef4444; }","    ","    .log-panel {","      display: flex;","      flex-direction: column;","      height: calc(100vh - 140px);","      min-height: 400px;","    }","    ","    .log-header {","      display: flex;","      justify-content: space-between;","      align-items: center;","      margin-bottom: 12px;","      flex-wrap: wrap;","      gap: 8px;","    }","    ","    .log-controls {","      display: flex;","      gap: 6px;","      flex-wrap: wrap;","    }","    ","    .log-controls button {","      padding: 5px 10px;","      border: none;","      border-radius: 5px;","      font-size: 0.75rem;","      cursor: pointer;","      background: rgba(255,255,255,0.1);","      color: #aaa;","      transition: all 0.15s;","    }","    ","    .log-controls button:hover {","      background: rgba(255,255,255,0.2);","      color: #fff;","    }","    ","    .log-controls button.active {","      background: #10b981;","      color: #000;","    }","    ","    .log {","      flex: 1;","      overflow-y: auto;","      background: #0a0a12;","      border-radius: 8px;","      padding: 12px;","      font-size: 0.75rem;","      line-height: 1.5;","    }","    ","    .log-entry {","      display: flex;","      gap: 10px;","      padding: 3px 0;","      border-bottom: 1px solid rgba(255,255,255,0.03);","    }","    ","    .log-entry:last-child { border-bottom: none; }","    ","    .log-entry .time {","      color: #555;","      flex-shrink: 0;","      width: 80px;","    }","    ","    .log-entry .type {","      flex-shrink: 0;","      width: 65px;","      font-weight: 600;","    }","    ","    .log-entry .type.midi { color: #8b5cf6; }","    .log-entry .type.gamepad { color: #f59e0b; }","    .log-entry .type.serial { color: #06b6d4; }","    .log-entry .type.keyboard { color: #ec4899; }","    .log-entry .type.system { color: #3b82f6; }","    ","    .log-entry .message {","      color: #bbb;","      flex: 1;","      word-break: break-all;","    }","    ","    .log-entry .value {","      color: #10b981;","      font-weight: 500;","    }","    ","    .empty-log {","      color: #444;","      text-align: center;","      padding: 40px;","    }","    ","    .gamepad-visual {","      display: grid;","      grid-template-columns: repeat(4, 1fr);","      gap: 4px;","      margin-top: 8px;","    }","    ","    .axis-bar, .button-indicator {","      height: 20px;","      background: rgba(255,255,255,0.1);","      border-radius: 3px;","      overflow: hidden;","      position: relative;","    }","    ","    .axis-bar .fill {","      position: absolute;","      top: 0;","      height: 100%;","      background: #f59e0b;","      transition: all 0.05s;","    }","    ","    .button-indicator {","      display: flex;","      align-items: center;","      justify-content: center;","      font-size: 0.65rem;","      color: #666;","    }","    ","    .button-indicator.pressed {","      background: #f59e0b;","      color: #000;","    }","    ","    .request-btn {","      width: 100%;","      padding: 8px;","      background: linear-gradient(135deg, #374151 0%, #1f2937 100%);","      border: 1px solid rgba(255,255,255,0.1);","      border-radius: 6px;","      color: #ccc;","      font-size: 0.8rem;","      cursor: pointer;","      margin-top: 8px;","      transition: all 0.15s;","    }","    ","    .request-btn:hover {","      background: linear-gradient(135deg, #4b5563 0%, #374151 100%);","      color: #fff;","    }","    ","    .request-btn.connected {","      background: linear-gradient(135deg, #065f46 0%, #064e3b 100%);","      border-color: #10b981;","    }","    ","    .serial-output {","      background: #000;","      border-radius: 4px;","      padding: 8px;","      font-size: 0.75rem;","      max-height: 80px;","      overflow-y: auto;","      margin-top: 8px;","      color: #0f0;","      white-space: pre-wrap;","      word-break: break-all;","    }","    ","    .serial-input {","      display: flex;","      gap: 4px;","      margin-top: 6px;","    }","    ","    .serial-input input {","      flex: 1;","      background: rgba(0,0,0,0.5);","      border: 1px solid rgba(255,255,255,0.2);","      border-radius: 4px;","      padding: 6px 8px;","      color: #fff;","      font-family: inherit;","      font-size: 0.75rem;","    }","    ","    .serial-input button {","      padding: 6px 12px;","      background: #06b6d4;","      border: none;","      border-radius: 4px;","      color: #000;","      font-size: 0.75rem;","      cursor: pointer;","    }","    ","    .keyboard-display {","      margin-top: 8px;","    }","    ","    .key-row {","      display: flex;","      gap: 4px;","      margin-bottom: 4px;","      flex-wrap: wrap;","    }","    ","    .key {","      min-width: 28px;","      height: 28px;","      background: rgba(255,255,255,0.1);","      border: 1px solid rgba(255,255,255,0.2);","      border-radius: 4px;","      display: flex;","      align-items: center;","      justify-content: center;","      font-size: 0.65rem;","      color: #888;","      transition: all 0.1s;","    }","    ","    .key.pressed {","      background: #ec4899;","      border-color: #ec4899;","      color: #000;","      transform: scale(0.95);","    }","    ","    .key.modifier {","      min-width: 40px;","      font-size: 0.6rem;","    }","    ","    .pressed-keys {","      margin-top: 8px;","      min-height: 24px;","      display: flex;","      flex-wrap: wrap;","      gap: 4px;","    }","    ","    .pressed-key {","      background: #ec4899;","      color: #000;","      padding: 2px 8px;","      border-radius: 4px;","      font-size: 0.7rem;","      font-weight: 600;","    }","    ","    .stats-grid {","      display: grid;","      grid-template-columns: 1fr 1fr;","      gap: 8px;","      font-size: 0.8rem;","    }","    ","    .stat-item {","      color: #666;","    }","    ","    .stat-item span {","      color: #10b981;","    }","  </style>","</head>","<body>","  <h1>üéõÔ∏è Input Logger</h1>","  <p class=\"subtitle\">MIDI ‚Ä¢ Gamepad ‚Ä¢ Serial ‚Ä¢ Keyboard</p>","  ","  <div class=\"container\">","    <div class=\"sidebar\">","      <div class=\"panel\">","        <h2><span class=\"icon\">üéπ</span> MIDI</h2>","        <div id=\"midiDevices\" class=\"device-list\">","          <div class=\"no-devices\">Click to request access</div>","        </div>","        <button class=\"request-btn\" id=\"requestMidi\">Request MIDI Access</button>","      </div>","      ","      <div class=\"panel\">","        <h2><span class=\"icon\">üéÆ</span> Gamepad</h2>","        <div id=\"gamepadDevices\" class=\"device-list\">","          <div class=\"no-devices\">Press a button to connect</div>","        </div>","        <div id=\"gamepadVisual\" class=\"gamepad-visual\" style=\"display: none;\"></div>","      </div>","      ","      <div class=\"panel\">","        <h2><span class=\"icon\">üîå</span> Serial</h2>","        <div id=\"serialDevices\" class=\"device-list\">","          <div class=\"no-devices\">Click to connect</div>","        </div>","        <button class=\"request-btn\" id=\"requestSerial\">Connect Serial Port</button>","        <div id=\"serialOutput\" class=\"serial-output\" style=\"display: none;\"></div>","        <div id=\"serialInputContainer\" class=\"serial-input\" style=\"display: none;\">","          <input type=\"text\" id=\"serialInput\" placeholder=\"Send data...\">","          <button id=\"serialSend\">Send</button>","        </div>","      </div>","      ","      <div class=\"panel\">","        <h2><span class=\"icon\">‚å®Ô∏è</span> Keyboard</h2>","        <div class=\"keyboard-display\">","          <div class=\"key-row\">","            <div class=\"key modifier\" id=\"key-ctrl\">Ctrl</div>","            <div class=\"key modifier\" id=\"key-alt\">Alt</div>","            <div class=\"key modifier\" id=\"key-shift\">Shift</div>","            <div class=\"key modifier\" id=\"key-meta\">‚åò</div>","          </div>","          <div class=\"pressed-keys\" id=\"pressedKeys\">","            <span class=\"no-devices\">Click log area, then type</span>","          </div>","        </div>","      </div>","      ","      <div class=\"panel\">","        <h2><span class=\"icon\">üìä</span> Stats</h2>","        <div class=\"stats-grid\">","          <div class=\"stat-item\">Events: <span id=\"eventCount\">0</span></div>","          <div class=\"stat-item\">Time: <span id=\"sessionTime\">0:00</span></div>","        </div>","      </div>","    </div>","    ","    <div class=\"panel log-panel\">","      <div class=\"log-header\">","        <h2><span class=\"icon\">üìú</span> Event Log</h2>","        <div class=\"log-controls\">","          <button id=\"filterAll\" class=\"active\">All</button>","          <button id=\"filterMidi\">MIDI</button>","          <button id=\"filterGamepad\">Gamepad</button>","          <button id=\"filterSerial\">Serial</button>","          <button id=\"filterKeyboard\">Keyboard</button>","          <button id=\"clearLog\">Clear</button>","          <button id=\"pauseLog\">Pause</button>","        </div>","      </div>","      <div id=\"log\" class=\"log\" tabindex=\"0\">","        <div class=\"empty-log\">Click here and press keys to log keyboard events</div>","      </div>","    </div>","  </div>","","  <script>","    // State","    let events = [];","    let eventCount = 0;","    let filter = 'all';","    let paused = false;","    let midiAccess = null;","    let gamepads = {};","    let lastGamepadState = {};","    let serialPort = null;","    let serialReader = null;","    let serialWriter = null;","    let pressedKeys = new Set();","    const startTime = Date.now();","    ","    // DOM elements","    const logEl = document.getElementById('log');","    const midiDevicesEl = document.getElementById('midiDevices');","    const gamepadDevicesEl = document.getElementById('gamepadDevices');","    const gamepadVisualEl = document.getElementById('gamepadVisual');","    const serialDevicesEl = document.getElementById('serialDevices');","    const serialOutputEl = document.getElementById('serialOutput');","    const eventCountEl = document.getElementById('eventCount');","    const sessionTimeEl = document.getElementById('sessionTime');","    const pressedKeysEl = document.getElementById('pressedKeys');","    ","    // Logging","    function log(type, message, value = null) {","      if (paused) return;","      ","      const time = new Date().toLocaleTimeString('en-US', { ","        hour12: false, ","        hour: '2-digit', ","        minute: '2-digit', ","        second: '2-digit',","        fractionalSecondDigits: 2","      });","      ","      events.push({ time, type, message, value });","      eventCount++;","      eventCountEl.textContent = eventCount;","      ","      if (events.length > 500) events.shift();","      renderLog();","    }","    ","    function renderLog() {","      const filtered = filter === 'all' ","        ? events ","        : events.filter(e => e.type === filter);","      ","      if (filtered.length === 0) {","        logEl.innerHTML = '<div class=\"empty-log\">Click here and press keys to log keyboard events</div>';","        return;","      }","      ","      logEl.innerHTML = filtered.slice(-100).map(e => `","        <div class=\"log-entry\">","          <span class=\"time\">${e.time}</span>","          <span class=\"type ${e.type}\">${e.type.toUpperCase()}</span>","          <span class=\"message\">${escapeHtml(e.message)}${e.value !== null ? ` <span class=\"value\">${escapeHtml(String(e.value))}</span>` : ''}</span>","        </div>","      `).join('');","      ","      logEl.scrollTop = logEl.scrollHeight;","    }","    ","    function escapeHtml(str) {","      return str.replace(/[&<>\"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\":'&#39;'}[c]));","    }","    ","    // ============ MIDI ============","    async function initMidi() {","      try {","        midiAccess = await navigator.requestMIDIAccess({ sysex: false });","        log('system', 'MIDI access granted');","        document.getElementById('requestMidi').classList.add('connected');","        document.getElementById('requestMidi').textContent = 'MIDI Connected';","        ","        midiAccess.onstatechange = (e) => {","          updateMidiDevices();","          log('system', `MIDI ${e.port.state}: ${e.port.name}`);","        };","        ","        updateMidiDevices();","      } catch (err) {","        midiDevicesEl.innerHTML = `<div class=\"no-devices\">${err.message}</div>`;","        log('system', `MIDI error: ${err.message}`);","      }","    }","    ","    function updateMidiDevices() {","      if (!midiAccess) return;","      ","      const inputs = Array.from(midiAccess.inputs.values());","      ","      if (inputs.length === 0) {","        midiDevicesEl.innerHTML = '<div class=\"no-devices\">No MIDI devices</div>';","        return;","      }","      ","      midiDevicesEl.innerHTML = inputs.map(input => `","        <div class=\"device\">","          <span class=\"status-dot ${input.state === 'connected' ? 'connected' : 'disconnected'}\"></span>","          <span class=\"name\">${input.name}</span>","          <div class=\"info\">${input.manufacturer || 'Unknown'}</div>","        </div>","      `).join('');","      ","      inputs.forEach(input => {","        input.onmidimessage = handleMidiMessage;","      });","    }","    ","    function handleMidiMessage(e) {","      const [status, data1, data2] = e.data;","      const channel = (status & 0x0F) + 1;","      const command = status >> 4;","      ","      let message = '';","      let value = null;","      ","      switch (command) {","        case 0x8:","          message = `Note Off ch${channel} note=${data1}`;","          value = `vel=${data2}`;","          break;","        case 0x9:","          if (data2 === 0) {","            message = `Note Off ch${channel} note=${data1}`;","          } else {","            message = `Note On ch${channel} note=${data1}`;","            value = `vel=${data2}`;","          }","          break;","        case 0xA:","          message = `Aftertouch ch${channel} note=${data1}`;","          value = data2;","          break;","        case 0xB:","          message = `CC ch${channel} ctrl=${data1}`;","          value = data2;","          break;","        case 0xC:","          message = `Program ch${channel}`;","          value = data1;","          break;","        case 0xD:","          message = `Pressure ch${channel}`;","          value = data1;","          break;","        case 0xE:","          const bend = ((data2 << 7) | data1) - 8192;","          message = `Pitch Bend ch${channel}`;","          value = bend;","          break;","        default:","          message = `Raw [${Array.from(e.data).map(b => b.toString(16).padStart(2,'0')).join(' ')}]`;","      }","      ","      log('midi', message, value);","    }","    ","    // ============ Gamepad ============","    function initGamepad() {","      window.addEventListener('gamepadconnected', (e) => {","        gamepads[e.gamepad.index] = e.gamepad;","        updateGamepadDevices();","        log('system', `Gamepad connected: ${e.gamepad.id.split('(')[0].trim()}`);","      });","      ","      window.addEventListener('gamepaddisconnected', (e) => {","        delete gamepads[e.gamepad.index];","        delete lastGamepadState[e.gamepad.index];","        updateGamepadDevices();","        log('system', `Gamepad disconnected`);","      });","      ","      requestAnimationFrame(pollGamepads);","    }","    ","    function updateGamepadDevices() {","      const pads = Object.values(gamepads);","      ","      if (pads.length === 0) {","        gamepadDevicesEl.innerHTML = '<div class=\"no-devices\">Press button to connect</div>';","        gamepadVisualEl.style.display = 'none';","        return;","      }","      ","      gamepadDevicesEl.innerHTML = pads.map(gp => `","        <div class=\"device\">","          <span class=\"status-dot connected\"></span>","          <span class=\"name\">${gp.id.split('(')[0].trim()}</span>","          <div class=\"info\">${gp.buttons.length}btn ${gp.axes.length}axes</div>","        </div>","      `).join('');","      ","      gamepadVisualEl.style.display = 'grid';","    }","    ","    function pollGamepads() {","      const pads = navigator.getGamepads();","      ","      for (const gp of pads) {","        if (!gp) continue;","        ","        gamepads[gp.index] = gp;","        const last = lastGamepadState[gp.index] || { buttons: [], axes: [] };","        ","        gp.buttons.forEach((btn, i) => {","          const wasPressed = last.buttons[i]?.pressed || false;","          if (btn.pressed && !wasPressed) {","            log('gamepad', `Button ${i} pressed`, btn.value.toFixed(2));","          } else if (!btn.pressed && wasPressed) {","            log('gamepad', `Button ${i} released`);","          }","        });","        ","        gp.axes.forEach((val, i) => {","          const lastVal = last.axes[i] || 0;","          if (Math.abs(val - lastVal) > 0.1) {","            if (Math.abs(val) > 0.5 || (Math.abs(lastVal) > 0.5 && Math.abs(val) < 0.2)) {","              log('gamepad', `Axis ${i}`, val.toFixed(2));","            }","          }","        });","        ","        lastGamepadState[gp.index] = {","          buttons: gp.buttons.map(b => ({ pressed: b.pressed, value: b.value })),","          axes: [...gp.axes]","        };","        ","        updateGamepadVisual(gp);","      }","      ","      requestAnimationFrame(pollGamepads);","    }","    ","    function updateGamepadVisual(gp) {","      const buttons = gp.buttons.slice(0, 12);","      const axes = gp.axes.slice(0, 4);","      ","      gamepadVisualEl.innerHTML = `","        ${axes.map((v, i) => `","          <div class=\"axis-bar\" title=\"Axis ${i}\">","            <div class=\"fill\" style=\"left: ${50 + v * 50}%; width: ${Math.abs(v) * 50}%; ${v < 0 ? 'transform: translateX(-100%);' : ''}\"></div>","          </div>","        `).join('')}","        ${buttons.map((b, i) => `","          <div class=\"button-indicator ${b.pressed ? 'pressed' : ''}\">${i}</div>","        `).join('')}","      `;","    }","    ","    // ============ Serial ============","    async function initSerial() {","      if (!('serial' in navigator)) {","        serialDevicesEl.innerHTML = '<div class=\"no-devices\">Web Serial not supported</div>';","        log('system', 'Web Serial API not supported');","        return;","      }","      ","      try {","        serialPort = await navigator.serial.requestPort();","        await serialPort.open({ baudRate: 115200 });","        ","        document.getElementById('requestSerial').classList.add('connected');","        document.getElementById('requestSerial').textContent = 'Connected';","        serialOutputEl.style.display = 'block';","        document.getElementById('serialInputContainer').style.display = 'flex';","        ","        const info = serialPort.getInfo();","        serialDevicesEl.innerHTML = `","          <div class=\"device\">","            <span class=\"status-dot connected\"></span>","            <span class=\"name\">Serial Port</span>","            <div class=\"info\">USB ${info.usbVendorId?.toString(16) || '?'}:${info.usbProductId?.toString(16) || '?'}</div>","          </div>","        `;","        ","        log('system', 'Serial port connected');","        ","        const textEncoder = new TextEncoderStream();","        textEncoder.readable.pipeTo(serialPort.writable);","        serialWriter = textEncoder.writable.getWriter();","        ","        const textDecoder = new TextDecoderStream();","        serialPort.readable.pipeTo(textDecoder.writable);","        serialReader = textDecoder.readable.getReader();","        ","        readSerial();","        ","      } catch (err) {","        if (err.name !== 'NotFoundError') {","          log('system', `Serial error: ${err.message}`);","        }","      }","    }","    ","    async function readSerial() {","      let buffer = '';","      try {","        while (true) {","          const { value, done } = await serialReader.read();","          if (done) break;","          ","          buffer += value;","          const lines = buffer.split('\\n');","          buffer = lines.pop();","          ","          for (const line of lines) {","            const trimmed = line.trim();","            if (trimmed) {","              log('serial', trimmed);","              appendSerialOutput(trimmed);","            }","          }","        }","      } catch (err) {","        log('system', `Serial read error: ${err.message}`);","      }","    }","    ","    function appendSerialOutput(text) {","      serialOutputEl.textContent += text + '\\n';","      const lines = serialOutputEl.textContent.split('\\n');","      if (lines.length > 50) {","        serialOutputEl.textContent = lines.slice(-50).join('\\n');","      }","      serialOutputEl.scrollTop = serialOutputEl.scrollHeight;","    }","    ","    async function sendSerial(text) {","      if (!serialWriter) return;","      try {","        await serialWriter.write(text + '\\n');","        log('serial', `TX: ${text}`);","      } catch (err) {","        log('system', `Serial write error: ${err.message}`);","      }","    }","    ","    // ============ Keyboard ============","    function initKeyboard() {","      document.addEventListener('keydown', handleKeyDown);","      document.addEventListener('keyup', handleKeyUp);","    }","    ","    function handleKeyDown(e) {","      // Update modifier display","      updateModifiers(e);","      ","      // Don't log if typing in serial input","      if (e.target.id === 'serialInput') return;","      ","      const keyInfo = getKeyInfo(e);","      ","      if (!pressedKeys.has(e.code)) {","        pressedKeys.add(e.code);","        updatePressedKeysDisplay();","        ","        log('keyboard', `‚Üì ${keyInfo.display}`, `code=${e.code} key=${e.key}`);","      } else if (e.repeat) {","        log('keyboard', `‚ü≥ ${keyInfo.display} (repeat)`, `code=${e.code}`);","      }","      ","      // Prevent default for most keys when log is focused","      if (document.activeElement === logEl && !e.metaKey && !e.ctrlKey) {","        e.preventDefault();","      }","    }","    ","    function handleKeyUp(e) {","      updateModifiers(e);","      ","      if (e.target.id === 'serialInput') return;","      ","      const keyInfo = getKeyInfo(e);","      ","      if (pressedKeys.has(e.code)) {","        pressedKeys.delete(e.code);","        updatePressedKeysDisplay();","        ","        log('keyboard', `‚Üë ${keyInfo.display}`, `code=${e.code}`);","      }","    }","    ","    function getKeyInfo(e) {","      let display = e.key;","      ","      // Make special keys more readable","      const specialKeys = {","        ' ': 'Space',","        'ArrowUp': '‚Üë',","        'ArrowDown': '‚Üì',","        'ArrowLeft': '‚Üê',","        'ArrowRight': '‚Üí',","        'Enter': '‚Üµ Enter',","        'Backspace': '‚å´ Backspace',","        'Tab': '‚á• Tab',","        'Escape': 'Esc',","        'Delete': 'Del',","        'Meta': '‚åò Cmd',","        'Control': 'Ctrl',","        'Alt': 'Alt',","        'Shift': 'Shift',","        'CapsLock': 'Caps'","      };","      ","      if (specialKeys[e.key]) {","        display = specialKeys[e.key];","      } else if (e.key.length === 1) {","        display = e.key.toUpperCase();","      }","      ","      // Add modifiers prefix","      let mods = [];","      if (e.metaKey && e.key !== 'Meta') mods.push('‚åò');","      if (e.ctrlKey && e.key !== 'Control') mods.push('Ctrl');","      if (e.altKey && e.key !== 'Alt') mods.push('Alt');","      if (e.shiftKey && e.key !== 'Shift' && e.key.length > 1) mods.push('Shift');","      ","      if (mods.length > 0) {","        display = mods.join('+') + '+' + display;","      }","      ","      return { display };","    }","    ","    function updateModifiers(e) {","      document.getElementById('key-ctrl').classList.toggle('pressed', e.ctrlKey);","      document.getElementById('key-alt').classList.toggle('pressed', e.altKey);","      document.getElementById('key-shift').classList.toggle('pressed', e.shiftKey);","      document.getElementById('key-meta').classList.toggle('pressed', e.metaKey);","    }","    ","    function updatePressedKeysDisplay() {","      if (pressedKeys.size === 0) {","        pressedKeysEl.innerHTML = '<span class=\"no-devices\">No keys pressed</span>';","      } else {","        pressedKeysEl.innerHTML = Array.from(pressedKeys).map(code => ","          `<span class=\"pressed-key\">${code.replace('Key', '').replace('Digit', '')}</span>`","        ).join('');","      }","    }","    ","    // ============ Controls ============","    document.getElementById('requestMidi').addEventListener('click', initMidi);","    document.getElementById('requestSerial').addEventListener('click', initSerial);","    ","    document.getElementById('serialSend').addEventListener('click', () => {","      const input = document.getElementById('serialInput');","      if (input.value) {","        sendSerial(input.value);","        input.value = '';","      }","    });","    ","    document.getElementById('serialInput').addEventListener('keypress', (e) => {","      if (e.key === 'Enter') {","        document.getElementById('serialSend').click();","      }","    });","    ","    document.getElementById('clearLog').addEventListener('click', () => {","      events = [];","      renderLog();","    });","    ","    document.getElementById('pauseLog').addEventListener('click', (e) => {","      paused = !paused;","      e.target.textContent = paused ? 'Resume' : 'Pause';","      e.target.classList.toggle('active', paused);","    });","    ","    ['All', 'Midi', 'Gamepad', 'Serial', 'Keyboard'].forEach(f => {","      document.getElementById(`filter${f}`).addEventListener('click', (e) => {","        filter = f.toLowerCase();","        document.querySelectorAll('.log-controls button').forEach(b => b.classList.remove('active'));","        e.target.classList.add('active');","        renderLog();","      });","    });","    ","    // Session timer","    setInterval(() => {","      const elapsed = Math.floor((Date.now() - startTime) / 1000);","      const mins = Math.floor(elapsed / 60);","      const secs = elapsed % 60;","      sessionTimeEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;","    }, 1000);","    ","    // Init","    initGamepad();","    initKeyboard();","    log('system', 'Input Logger initialized');","    ","    // Focus log for keyboard capture","    logEl.focus();","  </script>","</body>","</html>",""]}