{"type":"text","lines":["<!DOCTYPE html>","<html lang=\"en\">","<head>","  <meta charset=\"UTF-8\">","  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">","  <title>N2 Playground - Binary Format Explorer</title>","  <style>","    * { margin: 0; padding: 0; box-sizing: border-box; }","    ","    body {","      font-family: system-ui, -apple-system, sans-serif;","      background: #0d1117;","      color: #c9d1d9;","      height: 100vh;","      display: flex;","      flex-direction: column;","    }","    ","    .home-link { font-size: 1.2rem; text-decoration: none; margin-right: 12px; opacity: 0.7; transition: opacity 0.2s; }","    .home-link:hover { opacity: 1; }","    ","    header {","      background: #161b22;","      background: #161b22;","      padding: 1rem 2rem;","      border-bottom: 1px solid #30363d;","      display: flex;","      align-items: center;","      gap: 2rem;","    }","    ","    header h1 {","      font-size: 1.5rem;","      color: #58a6ff;","    }","    ","    header p {","      color: #8b949e;","      font-size: 0.9rem;","    }","    ","    .stats {","      margin-left: auto;","      display: flex;","      gap: 1.5rem;","      font-size: 0.85rem;","    }","    ","    .stat {","      display: flex;","      flex-direction: column;","      align-items: center;","    }","    ","    .stat-value {","      font-size: 1.2rem;","      font-weight: bold;","      color: #58a6ff;","    }","    ","    .stat-label {","      color: #8b949e;","      font-size: 0.75rem;","    }","    ","    .savings-positive { color: #3fb950; }","    .savings-negative { color: #f85149; }","    ","    main {","      flex: 1;","      display: flex;","      overflow: hidden;","    }","    ","    .panel {","      flex: 1;","      display: flex;","      flex-direction: column;","      border-right: 1px solid #30363d;","      min-width: 0;","    }","    ","    .panel:last-child {","      border-right: none;","    }","    ","    .panel-header {","      background: #161b22;","      padding: 0.75rem 1rem;","      font-weight: 600;","      font-size: 0.9rem;","      border-bottom: 1px solid #30363d;","      display: flex;","      justify-content: space-between;","      align-items: center;","    }","    ","    .panel-content {","      flex: 1;","      overflow: auto;","    }","    ","    textarea {","      width: 100%;","      height: 100%;","      background: #0d1117;","      color: #c9d1d9;","      border: none;","      padding: 1rem;","      font-family: 'Monaco', 'Menlo', monospace;","      font-size: 13px;","      resize: none;","      line-height: 1.6;","    }","    ","    textarea:focus {","      outline: none;","    }","    ","    .hex-view {","      padding: 1rem;","      font-family: 'Monaco', 'Menlo', monospace;","      font-size: 13px;","      line-height: 1.8;","    }","    ","    .hex-row {","      display: flex;","      gap: 1rem;","    }","    ","    .hex-offset {","      color: #8b949e;","      width: 4rem;","    }","    ","    .hex-bytes {","      display: flex;","      gap: 0.5rem;","      flex-wrap: wrap;","    }","    ","    .hex-byte {","      padding: 0.1rem 0.3rem;","      border-radius: 3px;","      cursor: pointer;","      transition: all 0.15s;","    }","    ","    .hex-byte:hover {","      transform: scale(1.1);","    }","    ","    .hex-byte.type-num { background: #1f6feb33; color: #58a6ff; }","    .hex-byte.type-str { background: #3fb95033; color: #3fb950; }","    .hex-byte.type-bin { background: #a371f733; color: #a371f7; }","    .hex-byte.type-lst { background: #f8514933; color: #f85149; }","    .hex-byte.type-map { background: #db610033; color: #db6100; }","    .hex-byte.type-ptr { background: #bf4b8a33; color: #bf4b8a; }","    .hex-byte.type-ref { background: #8b949e33; color: #8b949e; }","    .hex-byte.type-ext { background: #76818433; color: #768184; }","    .hex-byte.type-data { background: #21262d; color: #8b949e; }","    ","    .hex-ascii {","      color: #8b949e;","      margin-left: 1rem;","    }","    ","    .tree-view {","      padding: 1rem;","      font-family: 'Monaco', 'Menlo', monospace;","      font-size: 13px;","    }","    ","    .tree-node {","      padding: 0.2rem 0;","    }","    ","    .tree-node .type-badge {","      display: inline-block;","      padding: 0.1rem 0.4rem;","      border-radius: 3px;","      font-size: 0.7rem;","      margin-right: 0.5rem;","      font-weight: bold;","    }","    ","    .tree-node .bytes-info {","      color: #8b949e;","      font-size: 0.75rem;","      margin-left: 0.5rem;","    }","    ","    .tree-children {","      margin-left: 1.5rem;","      border-left: 1px solid #30363d;","      padding-left: 0.75rem;","    }","    ","    .type-badge.num { background: #1f6feb; color: white; }","    .type-badge.str { background: #3fb950; color: black; }","    .type-badge.bin { background: #a371f7; color: white; }","    .type-badge.lst { background: #f85149; color: white; }","    .type-badge.map { background: #db6100; color: white; }","    .type-badge.ref { background: #8b949e; color: white; }","    ","    .btn {","      background: #238636;","      color: white;","      border: none;","      padding: 0.4rem 0.8rem;","      border-radius: 6px;","      cursor: pointer;","      font-size: 0.8rem;","    }","    ","    .btn:hover {","      background: #2ea043;","    }","    ","    .btn-secondary {","      background: #21262d;","      border: 1px solid #30363d;","    }","    ","    .btn-secondary:hover {","      background: #30363d;","    }","    ","    .error {","      color: #f85149;","      padding: 1rem;","    }","    ","    .legend {","      display: flex;","      gap: 1rem;","      font-size: 0.75rem;","      flex-wrap: wrap;","    }","    ","    .legend-item {","      display: flex;","      align-items: center;","      gap: 0.3rem;","    }","    ","    .legend-color {","      width: 12px;","      height: 12px;","      border-radius: 2px;","    }","    ","    .tabs {","      display: flex;","      gap: 0.5rem;","    }","    ","    .tab {","      padding: 0.3rem 0.6rem;","      background: transparent;","      border: 1px solid #30363d;","      color: #8b949e;","      cursor: pointer;","      border-radius: 6px;","      font-size: 0.75rem;","    }","    ","    .tab.active {","      background: #21262d;","      color: #c9d1d9;","    }","  </style>","</head>","<body>","  <header>","    <a href=\"../\" class=\"home-link\" title=\"Back to App Launcher\">üè†</a>","    <h1>N2 Playground</h1>","    <p>Binary format with reverse TLV encoding</p>","    <div class=\"stats\">","      <div class=\"stat\">","        <span class=\"stat-value\" id=\"json-size\">0</span>","        <span class=\"stat-label\">JSON bytes</span>","      </div>","      <div class=\"stat\">","        <span class=\"stat-value\" id=\"n2-size\">0</span>","        <span class=\"stat-label\">N2 bytes</span>","      </div>","      <div class=\"stat\">","        <span class=\"stat-value\" id=\"savings\">0%</span>","        <span class=\"stat-label\">savings</span>","      </div>","    </div>","  </header>","  ","  <main>","    <div class=\"panel\">","      <div class=\"panel-header\">","        <span>JSON Input</span>","        <button class=\"btn\" onclick=\"loadSample()\">Load Sample</button>","      </div>","      <div class=\"panel-content\">","        <textarea id=\"json-input\" placeholder=\"Enter JSON here...\">{","  \"name\": \"N2 Format\",","  \"version\": 1,","  \"binary\": true,","  \"features\": [\"fast\", \"compact\", \"random-access\"]","}</textarea>","      </div>","    </div>","    ","    <div class=\"panel\">","      <div class=\"panel-header\">","        <span>Binary View</span>","        <div class=\"tabs\">","          <button class=\"tab active\" onclick=\"setView('hex')\">Hex</button>","          <button class=\"tab\" onclick=\"setView('tree')\">Tree</button>","        </div>","      </div>","      <div class=\"panel-content\">","        <div id=\"binary-output\"></div>","      </div>","    </div>","    ","    <div class=\"panel\">","      <div class=\"panel-header\">","        <span>Decoded</span>","        <button class=\"btn btn-secondary\" onclick=\"copyDecoded()\">Copy</button>","      </div>","      <div class=\"panel-content\">","        <textarea id=\"decoded-output\" readonly></textarea>","      </div>","    </div>","  </main>","","  <script>","    // N2 Type Constants","    const TYPE = {","      NUM: 0, // 000","      STR: 1, // 001","      BIN: 2, // 010","      LST: 3, // 011","      MAP: 4, // 100","      PTR: 5, // 101","      REF: 6, // 110","      EXT: 7  // 111","    };","    ","    const TYPE_NAMES = ['NUM', 'STR', 'BIN', 'LST', 'MAP', 'PTR', 'REF', 'EXT'];","    ","    // REF constants","    const REF_NIL = 0;","    const REF_TRUE = 1;","    const REF_FALSE = 2;","    ","    // N2 Encoder","    class N2Encoder {","      constructor() {","        this.buffer = [];","        this.annotations = []; // Track type for each byte","      }","      ","      encode(value) {","        this.buffer = [];","        this.annotations = [];","        this.encodeValue(value);","        return new Uint8Array(this.buffer);","      }","      ","      encodeValue(value) {","        if (value === null) {","          this.writeHeader(TYPE.REF, REF_NIL);","        } else if (value === true) {","          this.writeHeader(TYPE.REF, REF_TRUE);","        } else if (value === false) {","          this.writeHeader(TYPE.REF, REF_FALSE);","        } else if (typeof value === 'number') {","          this.encodeNumber(value);","        } else if (typeof value === 'string') {","          this.encodeString(value);","        } else if (Array.isArray(value)) {","          this.encodeList(value);","        } else if (typeof value === 'object') {","          this.encodeMap(value);","        }","      }","      ","      encodeNumber(n) {","        // Zigzag encode for signed integers","        const zigzag = n >= 0 ? n * 2 : (-n * 2) - 1;","        this.writeVarInt(TYPE.NUM, zigzag);","      }","      ","      encodeString(s) {","        const bytes = new TextEncoder().encode(s);","        const start = this.buffer.length;","        ","        // Write string bytes first (reverse TLV)","        for (const b of bytes) {","          this.buffer.push(b);","          this.annotations.push({ type: 'data', desc: 'string data' });","        }","        ","        // Write length + type header","        this.writeVarInt(TYPE.STR, bytes.length);","      }","      ","      encodeList(arr) {","        const start = this.buffer.length;","        ","        // Encode items in reverse order (last item first in buffer)","        for (let i = arr.length - 1; i >= 0; i--) {","          this.encodeValue(arr[i]);","        }","        ","        const contentLength = this.buffer.length - start;","        this.writeVarInt(TYPE.LST, contentLength);","      }","      ","      encodeMap(obj) {","        const keys = Object.keys(obj);","        const start = this.buffer.length;","        ","        // Encode key-value pairs in reverse","        for (let i = keys.length - 1; i >= 0; i--) {","          const key = keys[i];","          this.encodeValue(obj[key]);","          this.encodeString(key);","        }","        ","        const contentLength = this.buffer.length - start;","        this.writeVarInt(TYPE.MAP, contentLength);","      }","      ","      writeHeader(type, size) {","        const header = (type << 5) | (size & 0x1f);","        this.buffer.push(header);","        this.annotations.push({ type: TYPE_NAMES[type].toLowerCase(), desc: `${TYPE_NAMES[type]} header` });","      }","      ","      writeVarInt(type, value) {","        if (value < 28) {","          // Fits in 5 bits","          this.writeHeader(type, value);","        } else if (value < 256) {","          // 1 data byte","          this.buffer.push(value & 0xff);","          this.annotations.push({ type: TYPE_NAMES[type].toLowerCase(), desc: 'size byte' });","          this.writeHeader(type, 28);","        } else if (value < 65536) {","          // 2 data bytes (little endian)","          this.buffer.push(value & 0xff);","          this.annotations.push({ type: TYPE_NAMES[type].toLowerCase(), desc: 'size low' });","          this.buffer.push((value >> 8) & 0xff);","          this.annotations.push({ type: TYPE_NAMES[type].toLowerCase(), desc: 'size high' });","          this.writeHeader(type, 29);","        } else {","          // 4 data bytes","          this.buffer.push(value & 0xff);","          this.annotations.push({ type: TYPE_NAMES[type].toLowerCase(), desc: 'size b0' });","          this.buffer.push((value >> 8) & 0xff);","          this.annotations.push({ type: TYPE_NAMES[type].toLowerCase(), desc: 'size b1' });","          this.buffer.push((value >> 16) & 0xff);","          this.annotations.push({ type: TYPE_NAMES[type].toLowerCase(), desc: 'size b2' });","          this.buffer.push((value >> 24) & 0xff);","          this.annotations.push({ type: TYPE_NAMES[type].toLowerCase(), desc: 'size b3' });","          this.writeHeader(type, 30);","        }","      }","      ","      getAnnotations() {","        return this.annotations;","      }","    }","    ","    // N2 Decoder","    class N2Decoder {","      constructor(buffer) {","        this.buffer = buffer;","        this.pos = buffer.length; // Start from end","      }","      ","      decode() {","        this.pos = this.buffer.length;","        return this.decodeValue();","      }","      ","      decodeValue() {","        if (this.pos <= 0) return null;","        ","        const header = this.buffer[--this.pos];","        const type = (header >> 5) & 0x7;","        const sizeIndicator = header & 0x1f;","        ","        const size = this.readSize(sizeIndicator);","        ","        switch (type) {","          case TYPE.NUM:","            // Zigzag decode","            return size % 2 === 0 ? size / 2 : -(size + 1) / 2;","          case TYPE.STR:","            return this.readString(size);","          case TYPE.BIN:","            return this.readBytes(size);","          case TYPE.LST:","            return this.readList(size);","          case TYPE.MAP:","            return this.readMap(size);","          case TYPE.REF:","            if (size === REF_NIL) return null;","            if (size === REF_TRUE) return true;","            if (size === REF_FALSE) return false;","            return null;","          default:","            return null;","        }","      }","      ","      readSize(indicator) {","        if (indicator < 28) return indicator;","        ","        let bytes;","        switch (indicator) {","          case 28: bytes = 1; break;","          case 29: bytes = 2; break;","          case 30: bytes = 4; break;","          case 31: bytes = 8; break;","        }","        ","        let value = 0;","        for (let i = bytes - 1; i >= 0; i--) {","          value = (value << 8) | this.buffer[--this.pos];","        }","        return value;","      }","      ","      readString(length) {","        const bytes = new Uint8Array(length);","        for (let i = length - 1; i >= 0; i--) {","          bytes[i] = this.buffer[--this.pos];","        }","        return new TextDecoder().decode(bytes);","      }","      ","      readBytes(length) {","        const bytes = new Uint8Array(length);","        for (let i = length - 1; i >= 0; i--) {","          bytes[i] = this.buffer[--this.pos];","        }","        return bytes;","      }","      ","      readList(contentLength) {","        const endPos = this.pos - contentLength;","        const items = [];","        while (this.pos > endPos) {","          items.push(this.decodeValue());","        }","        return items;","      }","      ","      readMap(contentLength) {","        const endPos = this.pos - contentLength;","        const obj = {};","        while (this.pos > endPos) {","          const key = this.decodeValue();","          const value = this.decodeValue();","          if (typeof key === 'string') {","            obj[key] = value;","          }","        }","        return obj;","      }","    }","    ","    // UI State","    let currentView = 'hex';","    let currentBuffer = null;","    let currentAnnotations = [];","    ","    function update() {","      const input = document.getElementById('json-input').value;","      const binaryOutput = document.getElementById('binary-output');","      const decodedOutput = document.getElementById('decoded-output');","      ","      try {","        const json = JSON.parse(input);","        ","        // Encode","        const encoder = new N2Encoder();","        currentBuffer = encoder.encode(json);","        currentAnnotations = encoder.getAnnotations();","        ","        // Decode back","        const decoder = new N2Decoder(currentBuffer);","        const decoded = decoder.decode();","        ","        // Update stats","        const jsonSize = new TextEncoder().encode(input).length;","        const n2Size = currentBuffer.length;","        document.getElementById('json-size').textContent = jsonSize;","        document.getElementById('n2-size').textContent = n2Size;","        ","        const savingsEl = document.getElementById('savings');","        const savings = ((1 - n2Size / jsonSize) * 100).toFixed(1);","        savingsEl.textContent = (savings > 0 ? '+' : '') + savings + '%';","        savingsEl.className = savings > 0 ? 'stat-value savings-positive' : 'stat-value savings-negative';","        ","        // Render output","        renderBinary();","        decodedOutput.value = JSON.stringify(decoded, null, 2);","        ","      } catch (e) {","        binaryOutput.innerHTML = `<div class=\"error\">Error: ${e.message}</div>`;","        decodedOutput.value = '';","      }","    }","    ","    function renderBinary() {","      if (currentView === 'hex') {","        renderHexView();","      } else {","        renderTreeView();","      }","    }","    ","    function renderHexView() {","      const output = document.getElementById('binary-output');","      let html = '<div class=\"hex-view\">';","      ","      // Legend","      html += '<div class=\"legend\" style=\"margin-bottom:1rem;\">';","      html += '<div class=\"legend-item\"><div class=\"legend-color\" style=\"background:#1f6feb\"></div>NUM</div>';","      html += '<div class=\"legend-item\"><div class=\"legend-color\" style=\"background:#3fb950\"></div>STR</div>';","      html += '<div class=\"legend-item\"><div class=\"legend-color\" style=\"background:#f85149\"></div>LST</div>';","      html += '<div class=\"legend-item\"><div class=\"legend-color\" style=\"background:#db6100\"></div>MAP</div>';","      html += '<div class=\"legend-item\"><div class=\"legend-color\" style=\"background:#8b949e\"></div>REF</div>';","      html += '<div class=\"legend-item\"><div class=\"legend-color\" style=\"background:#21262d\"></div>data</div>';","      html += '</div>';","      ","      // Hex rows (16 bytes per row)","      for (let i = 0; i < currentBuffer.length; i += 16) {","        html += '<div class=\"hex-row\">';","        html += `<span class=\"hex-offset\">${i.toString(16).padStart(4, '0')}</span>`;","        html += '<span class=\"hex-bytes\">';","        ","        let ascii = '';","        for (let j = 0; j < 16 && i + j < currentBuffer.length; j++) {","          const byte = currentBuffer[i + j];","          const ann = currentAnnotations[i + j] || { type: 'data' };","          html += `<span class=\"hex-byte type-${ann.type}\" title=\"${ann.desc}\">${byte.toString(16).padStart(2, '0')}</span>`;","          ","          // ASCII representation","          ascii += byte >= 32 && byte < 127 ? String.fromCharCode(byte) : '.';","        }","        ","        html += '</span>';","        html += `<span class=\"hex-ascii\">${ascii}</span>`;","        html += '</div>';","      }","      ","      html += '</div>';","      output.innerHTML = html;","    }","    ","    function renderTreeView() {","      const output = document.getElementById('binary-output');","      ","      try {","        const json = JSON.parse(document.getElementById('json-input').value);","        const html = '<div class=\"tree-view\">' + renderTreeNode(json, 0) + '</div>';","        output.innerHTML = html;","      } catch (e) {","        output.innerHTML = `<div class=\"error\">Error: ${e.message}</div>`;","      }","    }","    ","    function renderTreeNode(value, depth) {","      if (value === null) {","        return `<div class=\"tree-node\"><span class=\"type-badge ref\">REF</span>null</div>`;","      }","      if (value === true || value === false) {","        return `<div class=\"tree-node\"><span class=\"type-badge ref\">REF</span>${value}</div>`;","      }","      if (typeof value === 'number') {","        return `<div class=\"tree-node\"><span class=\"type-badge num\">NUM</span>${value}</div>`;","      }","      if (typeof value === 'string') {","        return `<div class=\"tree-node\"><span class=\"type-badge str\">STR</span>\"${escapeHtml(value)}\"<span class=\"bytes-info\">${new TextEncoder().encode(value).length} bytes</span></div>`;","      }","      if (Array.isArray(value)) {","        let html = `<div class=\"tree-node\"><span class=\"type-badge lst\">LST</span>[${value.length} items]</div>`;","        if (value.length > 0) {","          html += '<div class=\"tree-children\">';","          value.forEach((item, idx) => {","            html += `<div><span style=\"color:#8b949e\">[${idx}]</span> ${renderTreeNode(item, depth + 1)}</div>`;","          });","          html += '</div>';","        }","        return html;","      }","      if (typeof value === 'object') {","        const keys = Object.keys(value);","        let html = `<div class=\"tree-node\"><span class=\"type-badge map\">MAP</span>{${keys.length} keys}</div>`;","        if (keys.length > 0) {","          html += '<div class=\"tree-children\">';","          keys.forEach(key => {","            html += `<div><span style=\"color:#58a6ff\">${escapeHtml(key)}:</span> ${renderTreeNode(value[key], depth + 1)}</div>`;","          });","          html += '</div>';","        }","        return html;","      }","      return '';","    }","    ","    function escapeHtml(str) {","      return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');","    }","    ","    function setView(view) {","      currentView = view;","      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));","      event.target.classList.add('active');","      renderBinary();","    }","    ","    function copyDecoded() {","      const text = document.getElementById('decoded-output').value;","      navigator.clipboard.writeText(text);","    }","    ","    function loadSample() {","      document.getElementById('json-input').value = JSON.stringify({","        \"users\": [","          {\"id\": 1, \"name\": \"Alice\", \"admin\": true},","          {\"id\": 2, \"name\": \"Bob\", \"admin\": false},","          {\"id\": 3, \"name\": \"Charlie\", \"admin\": false}","        ],","        \"settings\": {","          \"theme\": \"dark\",","          \"notifications\": true,","          \"maxItems\": 100","        },","        \"tags\": [\"important\", \"urgent\", \"review\"],","        \"count\": 42,","        \"active\": true,","        \"deleted\": null","      }, null, 2);","      update();","    }","    ","    // Initialize","    document.getElementById('json-input').addEventListener('input', update);","    update();","  </script>","  <script src=\"../demo-runner.js\"></script>","</body>","</html>"]}