{"type":"text","lines":["<!DOCTYPE html>","<html lang=\"en\">","<head>","  <meta charset=\"UTF-8\">","  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">","  <title>JSONito Playground</title>","  <style>","    * { margin: 0; padding: 0; box-sizing: border-box; }","    ","    :root {","      --bg-dark: #1e1e2e;","      --bg-darker: #181825;","      --bg-lighter: #313244;","      --border: #45475a;","      --text: #cdd6f4;","      --text-dim: #6c7086;","      --accent: #89b4fa;","      --accent2: #f5c2e7;","      --green: #a6e3a1;","      --red: #f38ba8;","      --yellow: #f9e2af;","      --orange: #fab387;","    }","    ","    body {","      font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;","      background: var(--bg-dark);","      color: var(--text);","      min-height: 100vh;","      display: flex;","      flex-direction: column;","    }","    ","    header {","      background: var(--bg-darker);","      padding: 12px 20px;","      border-bottom: 1px solid var(--border);","      display: flex;","      align-items: center;","      gap: 16px;","    }","    ","    header h1 {","      font-size: 18px;","      font-weight: 600;","      color: var(--accent);","    }","    ","    header h1::before {","      content: 'ðŸ“¦ ';","    }","    ","    .stats {","      margin-left: auto;","      font-size: 13px;","      color: var(--text-dim);","    }","    ","    .stats .saving { color: var(--green); font-weight: 600; }","    .stats .increase { color: var(--red); font-weight: 600; }","    ","    main {","      flex: 1;","      display: grid;","      grid-template-columns: 1fr 1fr;","      gap: 1px;","      background: var(--border);","    }","    ","    .panel {","      background: var(--bg-dark);","      display: flex;","      flex-direction: column;","    }","    ","    .panel-header {","      background: var(--bg-darker);","      padding: 8px 12px;","      font-size: 12px;","      font-weight: 600;","      text-transform: uppercase;","      letter-spacing: 0.5px;","      color: var(--text-dim);","      border-bottom: 1px solid var(--border);","      display: flex;","      align-items: center;","      gap: 8px;","    }","    ","    .panel-header .bytes {","      margin-left: auto;","      color: var(--accent);","      font-weight: normal;","      text-transform: none;","    }","    ","    .panel-content {","      flex: 1;","      overflow: auto;","    }","    ","    textarea {","      width: 100%;","      height: 100%;","      background: transparent;","      color: var(--text);","      border: none;","      padding: 12px;","      font-family: inherit;","      font-size: 13px;","      line-height: 1.6;","      resize: none;","    }","    ","    textarea:focus {","      outline: none;","    }","    ","    .output {","      padding: 12px;","      font-size: 13px;","      line-height: 1.6;","      white-space: pre-wrap;","      word-break: break-all;","    }","    ","    .output.error {","      color: var(--red);","    }","    ","    /* Syntax highlighting for JSONito output */","    .jito-ref { color: var(--accent); }","    .jito-string { color: var(--green); }","    .jito-number { color: var(--orange); }","    .jito-bool { color: var(--accent2); }","    .jito-null { color: var(--red); }","    .jito-struct { color: var(--yellow); }","    .jito-tag { color: var(--text-dim); }","    ","    .tabs {","      display: flex;","      background: var(--bg-darker);","      border-bottom: 1px solid var(--border);","    }","    ","    .tab {","      padding: 8px 16px;","      font-size: 12px;","      color: var(--text-dim);","      cursor: pointer;","      border: none;","      background: transparent;","    }","    ","    .tab:hover {","      color: var(--text);","    }","    ","    .tab.active {","      color: var(--accent);","      background: var(--bg-dark);","      border-bottom: 2px solid var(--accent);","    }","  </style>","</head>","<body>","  <header>","    <h1>JSONito Playground</h1>","    <div class=\"stats\" id=\"stats\">Enter JSON to encode</div>","  </header>","  ","  <main>","    <div class=\"panel\">","      <div class=\"panel-header\">","        JSON Input","        <span class=\"bytes\" id=\"json-bytes\">0 bytes</span>","      </div>","      <div class=\"panel-content\">","        <textarea id=\"input\" placeholder=\"Enter JSON here...\">{","  \"name\": \"JSONito\",","  \"type\": \"format\",","  \"features\": [\"compact\", \"references\", \"streaming\"],","  \"nested\": {","    \"array\": [1, 2, 3],","    \"bool\": true,","    \"null\": null","  },","  \"repeated\": \"format\",","  \"again\": \"format\"","}</textarea>","      </div>","    </div>","    ","    <div class=\"panel\">","      <div class=\"tabs\">","        <button class=\"tab active\" onclick=\"showTab('encoded')\">Encoded</button>","        <button class=\"tab\" onclick=\"showTab('decoded')\">Decoded</button>","        <button class=\"tab\" onclick=\"showTab('annotated')\">Annotated</button>","      </div>","      <div class=\"panel-header\">","        <span id=\"output-label\">JSONito Output</span>","        <span class=\"bytes\" id=\"jito-bytes\">0 bytes</span>","      </div>","      <div class=\"panel-content\">","        <div class=\"output\" id=\"output\"></div>","      </div>","    </div>","  </main>","","  <script type=\"module\">","    // JSONito library (MIT License, Tim Caswell)","    const B64_STR = /^([1-9a-zA-Z_-][0-9a-zA-Z_-]{0,7})$/","    const BASE64 = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_\"","    const fromB64 = new Map([...BASE64].map((c, i) => [c, i]))","    const inB64 = new Set(BASE64)","","    function encodeB64(num) {","      if (num === 0) return \"\"","      const digits = []","      let n = num","      while (n > 0) {","        digits.push(BASE64[n % 64])","        n = Math.floor(n / 64)","      }","      return digits.reverse().join(\"\")","    }","","    function encodeSignedB64(num) {","      if (num >= -2147483648 && num < 2147483648) {","        return encodeB64(((num >> 31) ^ (num << 1)) >>> 0)","      }","      return encodeB64(num < 0 ? num * -2 - 1 : num * 2)","    }","","    function parseB64(jito, start, end) {","      let num = 0","      for (let i = start; i < end; i++) {","        const digit = fromB64.get(jito[i])","        if (digit === undefined) throw new Error(`Invalid base64 digit: ${jito[i]}`)","        num = num * 64 + digit","      }","      return num","    }","","    function parseSignedB64(jito, start, end) {","      const b64 = parseB64(jito, start, end)","      return (b64 >> 1) ^ -(b64 & 1)","    }","","    const DEC_PARTS = /^(-?\\d+)(?:\\.(\\d+))?e[+]?([-]?\\d+)$/","    function splitDecimal(num) {","      const match = num.toExponential().match(DEC_PARTS)","      const [, b1, b2 = \"\", e1] = match","      const base = Number.parseInt(b1 + b2, 10)","      const exp = Number.parseInt(e1, 10) - b2.length","      return { base, exp }","    }","","    function stringify(rootValue, options = {}) {","      const parts = []","      const known = new Map()","      const willKnow = new Set()","      if (options.findDuplicates ?? true) {","        writeDuplicates(rootValue, parts, known, willKnow)","      }","      writeAny(rootValue, parts, known)","      return parts.join(\"\")","    }","","    function writeKey(key, parts, known) {","      const index = known.get(key)","      if (index !== undefined) return parts.push(encodeB64(index), \"*\")","      return writeString(key, parts)","    }","","    function writeAny(val, parts, known) {","      const index = known.get(val)","      if (index !== undefined) return parts.push(encodeB64(index), \"*\")","      if (val === null) return parts.push(\"N!\")","      if (typeof val === \"boolean\") return parts.push(val ? \"!\" : \"F!\")","      if (typeof val === \"number\") return writeNumber(val, parts)","      if (typeof val === \"string\") return writeString(val, parts)","      if (typeof val === \"object\") {","        if (Array.isArray(val)) return writeArray(val, parts, known)","        return writeObject(val, parts, known)","      }","      throw new Error(`TODO: implement writeAny for ${typeof val}`)","    }","","    function writeNumber(num, parts) {","      if (Number.isNaN(num)) return parts.push(\"n!\")","      if (num === 1 / 0) return parts.push(\"I!\")","      if (num === -1 / 0) return parts.push(\"i!\")","      const { base, exp } = splitDecimal(num)","      if (exp >= 0 && exp <= 4) return parts.push(encodeSignedB64(num), \".\")","      return parts.push(encodeSignedB64(exp), \":\", encodeSignedB64(base), \".\")","    }","","    function writeString(str, parts) {","      if (B64_STR.test(str)) return parts.push(str, \"'\")","      return parts.push(encodeB64(str.length), \"~\", str)","    }","","    function writeArray(arr, parts, known) {","      parts.push(\"[\")","      for (const v of arr) writeAny(v, parts, known)","      parts.push(\"]\")","    }","","    function writeObject(obj, parts, known) {","      parts.push(\"{\")","      for (const [k, v] of Object.entries(obj)) {","        writeKey(k, parts, known)","        writeAny(v, parts, known)","      }","      parts.push(\"}\")","    }","","    function writeDuplicates(rootVal, parts, known, willKnow) {","      const seen = new Map()","      walk(rootVal, seen)","      const repeats = [...seen.entries()].filter(([_, c]) => c > 1)","      const sorted = repeats.sort(([, a], [, b]) => b - a)","      const subParts = []","      for (const [val] of sorted) {","        if (known.has(val) || willKnow.has(val)) continue","        writeAny(val, subParts, known)","        const enc = subParts.join(\"\")","        subParts.length = 0","        const refCost = encodeB64(known.size).length + 1","        if (enc.length <= refCost) continue","        known.set(val, known.size)","        parts.push(enc)","      }","    }","","    function walk(val, seen) {","      if (!val) return","      if (typeof val === \"string\" || typeof val === \"number\") {","        seen.set(val, (seen.get(val) || 0) + 1)","      } else if (Array.isArray(val)) {","        for (const v of val) walk(v, seen)","      } else if (typeof val === \"object\") {","        for (const [k, v] of Object.entries(val)) {","          walk(k, seen)","          walk(v, seen)","        }","      }","    }","","    function parse(jito) {","      const seen = []","      let offset = skipWhitespace(jito, 0)","      while (offset < jito.length) {","        const { value, offset: newOffset } = parseAny(jito, offset, seen)","        offset = skipWhitespace(jito, newOffset)","        seen.push(value)","      }","      return seen.pop()","    }","","    function skipWhitespace(str, offset) {","      let o = offset","      while (o < str.length) {","        const c = str[o]","        if (c === \" \" || c === \"\\t\" || c === \"\\n\" || c === \"\\r\") { o++; continue }","        if (c === \"/\" && str[o + 1] === \"/\") {","          o += 2","          while (o < str.length && str[o] !== \"\\n\") o++","          o++","          continue","        }","        break","      }","      return o","    }","","    function skipB64(str, offset) {","      let o = offset","      while (o < str.length && inB64.has(str[o])) o++","      return o","    }","","    function parseAny(jito, offset, seen) {","      const start = skipWhitespace(jito, offset)","      let tag = jito[start]","      if (tag === \"[\") return parseList(jito, start + 1, seen)","      if (tag === \"{\") return parseObject(jito, start + 1, seen)","      const end = skipB64(jito, start)","      tag = jito[end]","      if (tag === \"'\") return { value: jito.slice(start, end), offset: end + 1 }","      if (tag === \".\") return { value: parseSignedB64(jito, start, end), offset: end + 1 }","      if (tag === \"~\") {","        const len = parseB64(jito, start, end)","        return { value: jito.slice(end + 1, end + 1 + len), offset: end + 1 + len }","      }","      if (tag === \":\") {","        const end2 = skipB64(jito, end + 1)","        if (jito[end2] === \".\") {","          const exp = parseSignedB64(jito, start, end)","          const base = parseSignedB64(jito, end + 1, end2)","          return { value: Number.parseFloat(`${base}e${exp}`), offset: end2 + 1 }","        }","      }","      if (tag === \"!\") {","        const b64 = parseB64(jito, start, end)","        if (b64 === 0) return { value: true, offset: end + 1 }","        if (b64 === 41) return { value: false, offset: end + 1 }","        if (b64 === 49) return { value: null, offset: end + 1 }","      }","      if (tag === \"*\") {","        const value = seen[parseB64(jito, start, end)]","        return { value, offset: end + 1 }","      }","      throw new SyntaxError(`Invalid JSONito at offset ${offset}`)","    }","","    function parseList(jito, offset, seen) {","      const list = []","      let o = skipWhitespace(jito, offset)","      while (o < jito.length) {","        if (jito[o] === \"]\") return { value: list, offset: o + 1 }","        const { value, offset: newOffset } = parseAny(jito, o, seen)","        list.push(value)","        o = skipWhitespace(jito, newOffset)","      }","      throw new SyntaxError(\"Unterminated list\")","    }","","    function parseObject(jito, offset, seen) {","      const entries = []","      let o = skipWhitespace(jito, offset)","      while (o < jito.length) {","        if (jito[o] === \"}\") return { value: Object.fromEntries(entries), offset: o + 1 }","        const { value: key, offset: o2 } = parseAny(jito, o, seen)","        const { value, offset: o3 } = parseAny(jito, skipWhitespace(jito, o2), seen)","        entries.push([key, value])","        o = skipWhitespace(jito, o3)","      }","      throw new SyntaxError(\"Unterminated object\")","    }","","    // Annotate JSONito for display","    function annotate(jito) {","      const parts = []","      let i = 0","      while (i < jito.length) {","        const c = jito[i]","        if (c === '[' || c === ']' || c === '{' || c === '}') {","          parts.push(`<span class=\"jito-struct\">${c}</span>`)","          i++","        } else if (c === \"'\") {","          parts.push(`<span class=\"jito-tag\">'</span>`)","          i++","        } else if (c === \".\" || c === \":\" || c === \"~\" || c === \"!\" || c === \"*\") {","          parts.push(`<span class=\"jito-tag\">${c}</span>`)","          i++","        } else if (inB64.has(c)) {","          const end = skipB64(jito, i)","          const b64 = jito.slice(i, end)","          const tag = jito[end]","          if (tag === \"'\") {","            parts.push(`<span class=\"jito-string\">${b64}</span>`)","          } else if (tag === \".\" || tag === \":\") {","            parts.push(`<span class=\"jito-number\">${b64}</span>`)","          } else if (tag === \"*\") {","            parts.push(`<span class=\"jito-ref\">${b64}</span>`)","          } else if (tag === \"!\") {","            parts.push(`<span class=\"jito-bool\">${b64}</span>`)","          } else if (tag === \"~\") {","            const len = parseB64(jito, i, end)","            parts.push(`<span class=\"jito-number\">${b64}</span><span class=\"jito-tag\">~</span><span class=\"jito-string\">${jito.slice(end + 1, end + 1 + len)}</span>`)","            i = end + 1 + len","            continue","          } else {","            parts.push(b64)","          }","          i = end","        } else {","          parts.push(c)","          i++","        }","      }","      return parts.join('')","    }","","    // UI","    let currentTab = 'encoded'","    let encodedOutput = ''","    let decodedOutput = ''","    ","    window.showTab = function(tab) {","      currentTab = tab","      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'))","      event.target.classList.add('active')","      updateOutput()","    }","","    function updateOutput() {","      const outputEl = document.getElementById('output')","      const labelEl = document.getElementById('output-label')","      ","      if (currentTab === 'encoded') {","        outputEl.innerHTML = annotate(encodedOutput)","        labelEl.textContent = 'JSONito Output'","      } else if (currentTab === 'decoded') {","        outputEl.className = 'output'","        outputEl.textContent = decodedOutput","        labelEl.textContent = 'Decoded JSON'","      } else {","        outputEl.innerHTML = annotate(encodedOutput)","        labelEl.textContent = 'Annotated (hover for info)'","      }","    }","","    function encode() {","      const input = document.getElementById('input').value","      const statsEl = document.getElementById('stats')","      const jsonBytesEl = document.getElementById('json-bytes')","      const jitoBytesEl = document.getElementById('jito-bytes')","      const outputEl = document.getElementById('output')","      ","      try {","        const data = JSON.parse(input)","        const jsonBytes = new TextEncoder().encode(input).length","        encodedOutput = stringify(data)","        const jitoBytes = new TextEncoder().encode(encodedOutput).length","        ","        // Decode back to verify","        const decoded = parse(encodedOutput)","        decodedOutput = JSON.stringify(decoded, null, 2)","        ","        jsonBytesEl.textContent = `${jsonBytes} bytes`","        jitoBytesEl.textContent = `${jitoBytes} bytes`","        ","        const savings = ((jsonBytes - jitoBytes) / jsonBytes * 100).toFixed(1)","        if (jitoBytes < jsonBytes) {","          statsEl.innerHTML = `Savings: <span class=\"saving\">${savings}%</span> (${jsonBytes - jitoBytes} bytes)`","        } else {","          statsEl.innerHTML = `Increase: <span class=\"increase\">${-savings}%</span> (${jitoBytes - jsonBytes} bytes)`","        }","        ","        updateOutput()","      } catch (e) {","        outputEl.className = 'output error'","        outputEl.textContent = `Error: ${e.message}`","        statsEl.textContent = 'Invalid input'","      }","    }","","    document.getElementById('input').addEventListener('input', encode)","    encode()","  </script>","</body>","</html>",""]}