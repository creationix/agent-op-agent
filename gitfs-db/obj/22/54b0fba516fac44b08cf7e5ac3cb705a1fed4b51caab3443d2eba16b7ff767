{"type":"text","lines":["<!DOCTYPE html>","<html lang=\"en\">","<head>","  <meta charset=\"UTF-8\">","  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">","  <title>N2 Playground - Binary Format Explorer</title>","  <link rel=\"stylesheet\" href=\"../shared/theme.css\">","  <link rel=\"stylesheet\" href=\"../shared/widgets.css\">","  <style>","    body {","      height: 100vh;","      display: flex;","      flex-direction: column;","    }","    ","    .header-stats {","      margin-left: auto;","      display: flex;","      gap: var(--space-lg);","      font-size: 0.85rem;","    }","    ","    .header-stat {","      display: flex;","      flex-direction: column;","      align-items: center;","    }","    ","    .header-stat-value {","      font-size: 1.2rem;","      font-weight: bold;","      color: var(--accent);","    }","    ","    .header-stat-label {","      color: var(--text-dim);","      font-size: 0.7rem;","    }","    ","    .savings-positive { color: var(--success); }","    .savings-negative { color: var(--error); }","    ","    main {","      flex: 1;","      display: flex;","      overflow: hidden;","    }","    ","    .panel {","      flex: 1;","      display: flex;","      flex-direction: column;","      border-right: 1px solid var(--border);","      border-radius: 0;","      min-width: 0;","    }","    ","    .panel:last-child { border-right: none; }","    ","    .panel-body {","      flex: 1;","      overflow: auto;","      padding: 0;","    }","    ","    textarea {","      width: 100%;","      height: 100%;","      background: var(--bg-base);","      color: var(--text);","      border: none;","      padding: var(--space-md);","      font-family: var(--font-mono);","      font-size: 0.8rem;","      resize: none;","      line-height: 1.6;","    }","    ","    textarea:focus { outline: none; }","    ","    .hex-view {","      padding: var(--space-md);","      font-family: var(--font-mono);","      font-size: 0.8rem;","      line-height: 1.8;","    }","    ","    .hex-row {","      display: flex;","      gap: var(--space-md);","    }","    ","    .hex-offset {","      color: var(--text-muted);","      width: 4rem;","    }","    ","    .hex-bytes {","      display: flex;","      gap: var(--space-xs);","      flex-wrap: wrap;","    }","    ","    .hex-byte {","      padding: 0.1rem 0.3rem;","      border-radius: 3px;","      cursor: pointer;","      transition: all var(--transition-fast);","    }","    ","    .hex-byte:hover { transform: scale(1.1); }","    ","    .hex-byte.type-num { background: rgba(137, 180, 250, 0.2); color: var(--accent); }","    .hex-byte.type-str { background: rgba(166, 227, 161, 0.2); color: var(--success); }","    .hex-byte.type-bin { background: rgba(203, 166, 247, 0.2); color: var(--accent2); }","    .hex-byte.type-lst { background: rgba(243, 139, 168, 0.2); color: var(--error); }","    .hex-byte.type-map { background: rgba(250, 179, 135, 0.2); color: var(--orange); }","    .hex-byte.type-ptr { background: rgba(245, 194, 231, 0.2); color: var(--accent3); }","    .hex-byte.type-ref { background: rgba(108, 112, 134, 0.2); color: var(--text-dim); }","    .hex-byte.type-ext { background: var(--bg-overlay); color: var(--text-muted); }","    .hex-byte.type-data { background: var(--bg-overlay); color: var(--text-muted); }","    ","    .hex-ascii {","      color: var(--text-muted);","      margin-left: var(--space-md);","    }","    ","    .tree-view {","      padding: var(--space-md);","      font-family: var(--font-mono);","      font-size: 0.8rem;","    }","    ","    .tree-node { padding: 0.2rem 0; }","    ","    .tree-node .type-badge {","      display: inline-block;","      padding: 0.1rem 0.4rem;","      border-radius: 3px;","      font-size: 0.65rem;","      margin-right: var(--space-sm);","      font-weight: bold;","    }","    ","    .tree-node .bytes-info {","      color: var(--text-muted);","      font-size: 0.7rem;","      margin-left: var(--space-sm);","    }","    ","    .tree-children {","      margin-left: var(--space-lg);","      border-left: 1px solid var(--border);","      padding-left: var(--space-sm);","    }","    ","    .type-badge.num { background: var(--accent); color: var(--bg-base); }","    .type-badge.str { background: var(--success); color: var(--bg-base); }","    .type-badge.bin { background: var(--accent2); color: var(--bg-base); }","    .type-badge.lst { background: var(--error); color: var(--bg-base); }","    .type-badge.map { background: var(--orange); color: var(--bg-base); }","    .type-badge.ref { background: var(--text-dim); color: var(--bg-base); }","    ","    .error { color: var(--error); padding: var(--space-md); }","    ","    .legend {","      display: flex;","      gap: var(--space-md);","      font-size: 0.7rem;","      flex-wrap: wrap;","      margin-bottom: var(--space-md);","    }","    ","    .legend-item {","      display: flex;","      align-items: center;","      gap: 0.3rem;","    }","    ","    .legend-color {","      width: 12px;","      height: 12px;","      border-radius: 2px;","    }","  </style>","</head>","<body>","  <header class=\"app-header\">","    <a href=\"../\" class=\"home-link\" title=\"Back to App Launcher\">üè†</a>","    <div>","      <h1>N2 Playground</h1>","      <p class=\"subtitle\">Binary format with reverse TLV encoding</p>","    </div>","    <div class=\"header-stats\">","      <div class=\"header-stat\">","        <span class=\"header-stat-value\" id=\"json-size\">0</span>","        <span class=\"header-stat-label\">JSON bytes</span>","      </div>","      <div class=\"header-stat\">","        <span class=\"header-stat-value\" id=\"n2-size\">0</span>","        <span class=\"header-stat-label\">N2 bytes</span>","      </div>","      <div class=\"header-stat\">","        <span class=\"header-stat-value\" id=\"savings\">0%</span>","        <span class=\"header-stat-label\">savings</span>","      </div>","    </div>","  </header>","  ","  <main>","    <div class=\"panel\">","      <div class=\"panel-header\">","        <span class=\"panel-title\">JSON Input</span>","        <button class=\"btn btn-sm\" onclick=\"loadSample()\">Load Sample</button>","      </div>","      <div class=\"panel-body\">","        <textarea id=\"json-input\" placeholder=\"Enter JSON here...\">{","  \"name\": \"N2 Format\",","  \"version\": 1,","  \"binary\": true,","  \"features\": [\"fast\", \"compact\", \"random-access\"]","}</textarea>","      </div>","    </div>","    ","    <div class=\"panel\">","      <div class=\"panel-header\">","        <span class=\"panel-title\">Binary View</span>","        <div class=\"tabs\">","          <button class=\"tab active\" onclick=\"setView('hex')\">Hex</button>","          <button class=\"tab\" onclick=\"setView('tree')\">Tree</button>","        </div>","      </div>","      <div class=\"panel-body\">","        <div id=\"binary-output\"></div>","      </div>","    </div>","    ","    <div class=\"panel\">","      <div class=\"panel-header\">","        <span class=\"panel-title\">Decoded</span>","        <button class=\"btn btn-sm btn-ghost\" onclick=\"copyDecoded()\">Copy</button>","      </div>","      <div class=\"panel-body\">","        <textarea id=\"decoded-output\" readonly></textarea>","      </div>","    </div>","  </main>","","  <script>","    const TYPE = { NUM: 0, STR: 1, BIN: 2, LST: 3, MAP: 4, PTR: 5, REF: 6, EXT: 7 };","    const TYPE_NAMES = ['NUM', 'STR', 'BIN', 'LST', 'MAP', 'PTR', 'REF', 'EXT'];","    const REF_NIL = 0, REF_TRUE = 1, REF_FALSE = 2;","    ","    class N2Encoder {","      constructor() { this.buffer = []; this.annotations = []; }","      ","      encode(value) {","        this.buffer = []; this.annotations = [];","        this.encodeValue(value);","        return new Uint8Array(this.buffer);","      }","      ","      encodeValue(value) {","        if (value === null) this.writeHeader(TYPE.REF, REF_NIL);","        else if (value === true) this.writeHeader(TYPE.REF, REF_TRUE);","        else if (value === false) this.writeHeader(TYPE.REF, REF_FALSE);","        else if (typeof value === 'number') this.encodeNumber(value);","        else if (typeof value === 'string') this.encodeString(value);","        else if (Array.isArray(value)) this.encodeList(value);","        else if (typeof value === 'object') this.encodeMap(value);","      }","      ","      encodeNumber(n) {","        const zigzag = n >= 0 ? n * 2 : (-n * 2) - 1;","        this.writeVarInt(TYPE.NUM, zigzag);","      }","      ","      encodeString(s) {","        const bytes = new TextEncoder().encode(s);","        for (const b of bytes) {","          this.buffer.push(b);","          this.annotations.push({ type: 'data', desc: 'string data' });","        }","        this.writeVarInt(TYPE.STR, bytes.length);","      }","      ","      encodeList(arr) {","        const start = this.buffer.length;","        for (let i = arr.length - 1; i >= 0; i--) this.encodeValue(arr[i]);","        this.writeVarInt(TYPE.LST, this.buffer.length - start);","      }","      ","      encodeMap(obj) {","        const keys = Object.keys(obj);","        const start = this.buffer.length;","        for (let i = keys.length - 1; i >= 0; i--) {","          this.encodeValue(obj[keys[i]]);","          this.encodeString(keys[i]);","        }","        this.writeVarInt(TYPE.MAP, this.buffer.length - start);","      }","      ","      writeHeader(type, size) {","        this.buffer.push((type << 5) | (size & 0x1f));","        this.annotations.push({ type: TYPE_NAMES[type].toLowerCase(), desc: `${TYPE_NAMES[type]} header` });","      }","      ","      writeVarInt(type, value) {","        if (value < 28) { this.writeHeader(type, value); }","        else if (value < 256) {","          this.buffer.push(value & 0xff);","          this.annotations.push({ type: TYPE_NAMES[type].toLowerCase(), desc: 'size byte' });","          this.writeHeader(type, 28);","        } else if (value < 65536) {","          this.buffer.push(value & 0xff);","          this.annotations.push({ type: TYPE_NAMES[type].toLowerCase(), desc: 'size low' });","          this.buffer.push((value >> 8) & 0xff);","          this.annotations.push({ type: TYPE_NAMES[type].toLowerCase(), desc: 'size high' });","          this.writeHeader(type, 29);","        } else {","          for (let i = 0; i < 4; i++) {","            this.buffer.push((value >> (i * 8)) & 0xff);","            this.annotations.push({ type: TYPE_NAMES[type].toLowerCase(), desc: `size b${i}` });","          }","          this.writeHeader(type, 30);","        }","      }","      ","      getAnnotations() { return this.annotations; }","    }","    ","    class N2Decoder {","      constructor(buffer) { this.buffer = buffer; this.pos = buffer.length; }","      ","      decode() { this.pos = this.buffer.length; return this.decodeValue(); }","      ","      decodeValue() {","        if (this.pos <= 0) return null;","        const header = this.buffer[--this.pos];","        const type = (header >> 5) & 0x7, sizeIndicator = header & 0x1f;","        const size = this.readSize(sizeIndicator);","        ","        switch (type) {","          case TYPE.NUM: return size % 2 === 0 ? size / 2 : -(size + 1) / 2;","          case TYPE.STR: return this.readString(size);","          case TYPE.BIN: return this.readBytes(size);","          case TYPE.LST: return this.readList(size);","          case TYPE.MAP: return this.readMap(size);","          case TYPE.REF:","            if (size === REF_NIL) return null;","            if (size === REF_TRUE) return true;","            if (size === REF_FALSE) return false;","          default: return null;","        }","      }","      ","      readSize(indicator) {","        if (indicator < 28) return indicator;","        const bytes = indicator === 28 ? 1 : indicator === 29 ? 2 : indicator === 30 ? 4 : 8;","        let value = 0;","        for (let i = bytes - 1; i >= 0; i--) value = (value << 8) | this.buffer[--this.pos];","        return value;","      }","      ","      readString(length) {","        const bytes = new Uint8Array(length);","        for (let i = length - 1; i >= 0; i--) bytes[i] = this.buffer[--this.pos];","        return new TextDecoder().decode(bytes);","      }","      ","      readBytes(length) {","        const bytes = new Uint8Array(length);","        for (let i = length - 1; i >= 0; i--) bytes[i] = this.buffer[--this.pos];","        return bytes;","      }","      ","      readList(contentLength) {","        const endPos = this.pos - contentLength, items = [];","        while (this.pos > endPos) items.push(this.decodeValue());","        return items;","      }","      ","      readMap(contentLength) {","        const endPos = this.pos - contentLength, obj = {};","        while (this.pos > endPos) {","          const key = this.decodeValue(), value = this.decodeValue();","          if (typeof key === 'string') obj[key] = value;","        }","        return obj;","      }","    }","    ","    let currentView = 'hex', currentBuffer = null, currentAnnotations = [];","    ","    function update() {","      const input = document.getElementById('json-input').value;","      const binaryOutput = document.getElementById('binary-output');","      const decodedOutput = document.getElementById('decoded-output');","      ","      try {","        const json = JSON.parse(input);","        const encoder = new N2Encoder();","        currentBuffer = encoder.encode(json);","        currentAnnotations = encoder.getAnnotations();","        ","        const decoder = new N2Decoder(currentBuffer);","        const decoded = decoder.decode();","        ","        const jsonSize = new TextEncoder().encode(input).length;","        const n2Size = currentBuffer.length;","        document.getElementById('json-size').textContent = jsonSize;","        document.getElementById('n2-size').textContent = n2Size;","        ","        const savingsEl = document.getElementById('savings');","        const savings = ((1 - n2Size / jsonSize) * 100).toFixed(1);","        savingsEl.textContent = (savings > 0 ? '+' : '') + savings + '%';","        savingsEl.className = 'header-stat-value ' + (savings > 0 ? 'savings-positive' : 'savings-negative');","        ","        renderBinary();","        decodedOutput.value = JSON.stringify(decoded, null, 2);","      } catch (e) {","        binaryOutput.innerHTML = `<div class=\"error\">Error: ${e.message}</div>`;","        decodedOutput.value = '';","      }","    }","    ","    function renderBinary() {","      currentView === 'hex' ? renderHexView() : renderTreeView();","    }","    ","    function renderHexView() {","      const output = document.getElementById('binary-output');","      let html = '<div class=\"hex-view\"><div class=\"legend\">';","      html += '<div class=\"legend-item\"><div class=\"legend-color\" style=\"background:var(--accent)\"></div>NUM</div>';","      html += '<div class=\"legend-item\"><div class=\"legend-color\" style=\"background:var(--success)\"></div>STR</div>';","      html += '<div class=\"legend-item\"><div class=\"legend-color\" style=\"background:var(--error)\"></div>LST</div>';","      html += '<div class=\"legend-item\"><div class=\"legend-color\" style=\"background:var(--orange)\"></div>MAP</div>';","      html += '<div class=\"legend-item\"><div class=\"legend-color\" style=\"background:var(--text-dim)\"></div>REF</div>';","      html += '<div class=\"legend-item\"><div class=\"legend-color\" style=\"background:var(--bg-overlay)\"></div>data</div></div>';","      ","      for (let i = 0; i < currentBuffer.length; i += 16) {","        html += '<div class=\"hex-row\">';","        html += `<span class=\"hex-offset\">${i.toString(16).padStart(4, '0')}</span><span class=\"hex-bytes\">`;","        let ascii = '';","        for (let j = 0; j < 16 && i + j < currentBuffer.length; j++) {","          const byte = currentBuffer[i + j];","          const ann = currentAnnotations[i + j] || { type: 'data' };","          html += `<span class=\"hex-byte type-${ann.type}\" title=\"${ann.desc}\">${byte.toString(16).padStart(2, '0')}</span>`;","          ascii += byte >= 32 && byte < 127 ? String.fromCharCode(byte) : '.';","        }","        html += `</span><span class=\"hex-ascii\">${ascii}</span></div>`;","      }","      html += '</div>';","      output.innerHTML = html;","    }","    ","    function renderTreeView() {","      const output = document.getElementById('binary-output');","      try {","        const json = JSON.parse(document.getElementById('json-input').value);","        output.innerHTML = '<div class=\"tree-view\">' + renderTreeNode(json, 0) + '</div>';","      } catch (e) {","        output.innerHTML = `<div class=\"error\">Error: ${e.message}</div>`;","      }","    }","    ","    function renderTreeNode(value, depth) {","      if (value === null) return `<div class=\"tree-node\"><span class=\"type-badge ref\">REF</span>null</div>`;","      if (value === true || value === false) return `<div class=\"tree-node\"><span class=\"type-badge ref\">REF</span>${value}</div>`;","      if (typeof value === 'number') return `<div class=\"tree-node\"><span class=\"type-badge num\">NUM</span>${value}</div>`;","      if (typeof value === 'string') return `<div class=\"tree-node\"><span class=\"type-badge str\">STR</span>\"${escapeHtml(value)}\"<span class=\"bytes-info\">${new TextEncoder().encode(value).length} bytes</span></div>`;","      if (Array.isArray(value)) {","        let html = `<div class=\"tree-node\"><span class=\"type-badge lst\">LST</span>[${value.length} items]</div>`;","        if (value.length > 0) {","          html += '<div class=\"tree-children\">';","          value.forEach((item, idx) => { html += `<div><span style=\"color:var(--text-muted)\">[${idx}]</span> ${renderTreeNode(item, depth + 1)}</div>`; });","          html += '</div>';","        }","        return html;","      }","      if (typeof value === 'object') {","        const keys = Object.keys(value);","        let html = `<div class=\"tree-node\"><span class=\"type-badge map\">MAP</span>{${keys.length} keys}</div>`;","        if (keys.length > 0) {","          html += '<div class=\"tree-children\">';","          keys.forEach(key => { html += `<div><span style=\"color:var(--accent)\">${escapeHtml(key)}:</span> ${renderTreeNode(value[key], depth + 1)}</div>`; });","          html += '</div>';","        }","        return html;","      }","      return '';","    }","    ","    function escapeHtml(str) { return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); }","    ","    function setView(view) {","      currentView = view;","      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));","      event.target.classList.add('active');","      renderBinary();","    }","    ","    function copyDecoded() { navigator.clipboard.writeText(document.getElementById('decoded-output').value); }","    ","    function loadSample() {","      document.getElementById('json-input').value = JSON.stringify({","        \"users\": [{\"id\": 1, \"name\": \"Alice\", \"admin\": true}, {\"id\": 2, \"name\": \"Bob\", \"admin\": false}, {\"id\": 3, \"name\": \"Charlie\", \"admin\": false}],","        \"settings\": {\"theme\": \"dark\", \"notifications\": true, \"maxItems\": 100},","        \"tags\": [\"important\", \"urgent\", \"review\"],","        \"count\": 42, \"active\": true, \"deleted\": null","      }, null, 2);","      update();","    }","    ","    document.getElementById('json-input').addEventListener('input', update);","    update();","  </script>","  <script src=\"../demo-runner.js\"></script>","</body>","</html>",""]}