{"type":"text","lines":["<!DOCTYPE html>","<html lang=\"en\">","<head>","  <meta charset=\"UTF-8\">","  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">","  <title>Input Logger - MIDI & Gamepad</title>","  <style>","    * { margin: 0; padding: 0; box-sizing: border-box; }","    ","    body {","      font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;","      background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);","      min-height: 100vh;","      color: #e0e0e0;","      padding: 20px;","    }","    ","    h1 {","      color: #10b981;","      margin-bottom: 8px;","      font-size: 1.8rem;","      display: flex;","      align-items: center;","      gap: 12px;","    }","    ","    .subtitle {","      color: #666;","      margin-bottom: 20px;","      font-size: 0.9rem;","    }","    ","    .container {","      display: grid;","      grid-template-columns: 280px 1fr;","      gap: 20px;","      max-width: 1400px;","      margin: 0 auto;","    }","    ","    @media (max-width: 800px) {","      .container { grid-template-columns: 1fr; }","    }","    ","    .sidebar {","      display: flex;","      flex-direction: column;","      gap: 16px;","    }","    ","    .panel {","      background: rgba(255,255,255,0.03);","      border: 1px solid rgba(255,255,255,0.1);","      border-radius: 12px;","      padding: 16px;","    }","    ","    .panel h2 {","      font-size: 0.8rem;","      text-transform: uppercase;","      letter-spacing: 1px;","      color: #888;","      margin-bottom: 12px;","      display: flex;","      align-items: center;","      gap: 8px;","    }","    ","    .panel h2 .icon { font-size: 1.1rem; }","    ","    .device-list {","      display: flex;","      flex-direction: column;","      gap: 8px;","    }","    ","    .device {","      background: rgba(255,255,255,0.05);","      padding: 10px 12px;","      border-radius: 8px;","      font-size: 0.85rem;","    }","    ","    .device .name {","      color: #fff;","      font-weight: 500;","    }","    ","    .device .info {","      color: #666;","      font-size: 0.75rem;","      margin-top: 4px;","    }","    ","    .no-devices {","      color: #666;","      font-size: 0.85rem;","      font-style: italic;","    }","    ","    .status-dot {","      width: 8px;","      height: 8px;","      border-radius: 50%;","      display: inline-block;","      margin-right: 6px;","    }","    ","    .status-dot.connected { background: #10b981; }","    .status-dot.disconnected { background: #ef4444; }","    .status-dot.pending { background: #f59e0b; }","    ","    .log-panel {","      display: flex;","      flex-direction: column;","      height: calc(100vh - 140px);","      min-height: 400px;","    }","    ","    .log-header {","      display: flex;","      justify-content: space-between;","      align-items: center;","      margin-bottom: 12px;","    }","    ","    .log-header h2 {","      margin: 0;","    }","    ","    .log-controls {","      display: flex;","      gap: 8px;","    }","    ","    .log-controls button {","      padding: 6px 12px;","      border: none;","      border-radius: 6px;","      font-size: 0.8rem;","      cursor: pointer;","      background: rgba(255,255,255,0.1);","      color: #aaa;","      transition: all 0.15s;","    }","    ","    .log-controls button:hover {","      background: rgba(255,255,255,0.2);","      color: #fff;","    }","    ","    .log-controls button.active {","      background: #10b981;","      color: #000;","    }","    ","    .log {","      flex: 1;","      overflow-y: auto;","      background: #0a0a12;","      border-radius: 8px;","      padding: 12px;","      font-size: 0.8rem;","      line-height: 1.6;","    }","    ","    .log-entry {","      display: flex;","      gap: 12px;","      padding: 4px 0;","      border-bottom: 1px solid rgba(255,255,255,0.03);","    }","    ","    .log-entry:last-child {","      border-bottom: none;","    }","    ","    .log-entry .time {","      color: #666;","      flex-shrink: 0;","      width: 85px;","    }","    ","    .log-entry .type {","      flex-shrink: 0;","      width: 70px;","      font-weight: 600;","    }","    ","    .log-entry .type.midi { color: #8b5cf6; }","    .log-entry .type.gamepad { color: #f59e0b; }","    .log-entry .type.system { color: #3b82f6; }","    ","    .log-entry .message {","      color: #ccc;","      flex: 1;","    }","    ","    .log-entry .value {","      color: #10b981;","      font-weight: 500;","    }","    ","    .empty-log {","      color: #444;","      text-align: center;","      padding: 40px;","    }","    ","    .gamepad-visual {","      display: grid;","      grid-template-columns: repeat(4, 1fr);","      gap: 6px;","      margin-top: 12px;","    }","    ","    .axis-bar, .button-indicator {","      height: 24px;","      background: rgba(255,255,255,0.1);","      border-radius: 4px;","      overflow: hidden;","      position: relative;","    }","    ","    .axis-bar .fill {","      position: absolute;","      top: 0;","      height: 100%;","      background: #f59e0b;","      transition: all 0.05s;","    }","    ","    .button-indicator {","      display: flex;","      align-items: center;","      justify-content: center;","      font-size: 0.7rem;","      color: #666;","    }","    ","    .button-indicator.pressed {","      background: #f59e0b;","      color: #000;","    }","    ","    .request-btn {","      width: 100%;","      padding: 10px;","      background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);","      border: none;","      border-radius: 8px;","      color: white;","      font-size: 0.85rem;","      cursor: pointer;","      margin-top: 8px;","    }","    ","    .request-btn:hover {","      opacity: 0.9;","    }","  </style>","</head>","<body>","  <h1>üéõÔ∏è Input Logger</h1>","  <p class=\"subtitle\">MIDI &amp; Gamepad event recorder</p>","  ","  <div class=\"container\">","    <div class=\"sidebar\">","      <div class=\"panel\">","        <h2><span class=\"icon\">üéπ</span> MIDI Devices</h2>","        <div id=\"midiDevices\" class=\"device-list\">","          <div class=\"no-devices\">Requesting access...</div>","        </div>","        <button class=\"request-btn\" id=\"requestMidi\">Request MIDI Access</button>","      </div>","      ","      <div class=\"panel\">","        <h2><span class=\"icon\">üéÆ</span> Gamepads</h2>","        <div id=\"gamepadDevices\" class=\"device-list\">","          <div class=\"no-devices\">Press a button to connect</div>","        </div>","        <div id=\"gamepadVisual\" class=\"gamepad-visual\" style=\"display: none;\"></div>","      </div>","      ","      <div class=\"panel\">","        <h2><span class=\"icon\">üìä</span> Stats</h2>","        <div style=\"font-size: 0.85rem; color: #888;\">","          <div>Events logged: <span id=\"eventCount\" style=\"color: #10b981;\">0</span></div>","          <div>Session time: <span id=\"sessionTime\" style=\"color: #10b981;\">0:00</span></div>","        </div>","      </div>","    </div>","    ","    <div class=\"panel log-panel\">","      <div class=\"log-header\">","        <h2><span class=\"icon\">üìú</span> Event Log</h2>","        <div class=\"log-controls\">","          <button id=\"filterAll\" class=\"active\">All</button>","          <button id=\"filterMidi\">MIDI</button>","          <button id=\"filterGamepad\">Gamepad</button>","          <button id=\"clearLog\">Clear</button>","          <button id=\"pauseLog\">Pause</button>","        </div>","      </div>","      <div id=\"log\" class=\"log\">","        <div class=\"empty-log\">Waiting for input events...</div>","      </div>","    </div>","  </div>","","  <script>","    // State","    let events = [];","    let eventCount = 0;","    let filter = 'all';","    let paused = false;","    let midiAccess = null;","    let gamepads = {};","    let lastGamepadState = {};","    const startTime = Date.now();","    ","    // DOM elements","    const logEl = document.getElementById('log');","    const midiDevicesEl = document.getElementById('midiDevices');","    const gamepadDevicesEl = document.getElementById('gamepadDevices');","    const gamepadVisualEl = document.getElementById('gamepadVisual');","    const eventCountEl = document.getElementById('eventCount');","    const sessionTimeEl = document.getElementById('sessionTime');","    ","    // Logging","    function log(type, message, value = null) {","      if (paused) return;","      ","      const time = new Date().toLocaleTimeString('en-US', { ","        hour12: false, ","        hour: '2-digit', ","        minute: '2-digit', ","        second: '2-digit',","        fractionalSecondDigits: 2","      });","      ","      events.push({ time, type, message, value });","      eventCount++;","      eventCountEl.textContent = eventCount;","      ","      // Keep last 500 events","      if (events.length > 500) events.shift();","      ","      renderLog();","    }","    ","    function renderLog() {","      const filtered = filter === 'all' ","        ? events ","        : events.filter(e => e.type === filter);","      ","      if (filtered.length === 0) {","        logEl.innerHTML = '<div class=\"empty-log\">No events to display</div>';","        return;","      }","      ","      logEl.innerHTML = filtered.slice(-100).map(e => `","        <div class=\"log-entry\">","          <span class=\"time\">${e.time}</span>","          <span class=\"type ${e.type}\">${e.type.toUpperCase()}</span>","          <span class=\"message\">${e.message}${e.value !== null ? ` <span class=\"value\">${e.value}</span>` : ''}</span>","        </div>","      `).join('');","      ","      // Auto-scroll to bottom","      logEl.scrollTop = logEl.scrollHeight;","    }","    ","    // MIDI","    async function initMidi() {","      try {","        midiAccess = await navigator.requestMIDIAccess({ sysex: false });","        log('system', 'MIDI access granted');","        ","        midiAccess.onstatechange = (e) => {","          updateMidiDevices();","          log('system', `MIDI device ${e.port.state}: ${e.port.name}`);","        };","        ","        updateMidiDevices();","      } catch (err) {","        midiDevicesEl.innerHTML = `<div class=\"no-devices\">MIDI not available: ${err.message}</div>`;","        log('system', `MIDI error: ${err.message}`);","      }","    }","    ","    function updateMidiDevices() {","      if (!midiAccess) return;","      ","      const inputs = Array.from(midiAccess.inputs.values());","      ","      if (inputs.length === 0) {","        midiDevicesEl.innerHTML = '<div class=\"no-devices\">No MIDI devices found</div>';","        return;","      }","      ","      midiDevicesEl.innerHTML = inputs.map(input => `","        <div class=\"device\">","          <span class=\"status-dot ${input.state === 'connected' ? 'connected' : 'disconnected'}\"></span>","          <span class=\"name\">${input.name}</span>","          <div class=\"info\">${input.manufacturer || 'Unknown'}</div>","        </div>","      `).join('');","      ","      // Attach listeners","      inputs.forEach(input => {","        input.onmidimessage = handleMidiMessage;","      });","    }","    ","    function handleMidiMessage(e) {","      const [status, data1, data2] = e.data;","      const channel = (status & 0x0F) + 1;","      const command = status >> 4;","      ","      let message = '';","      let value = null;","      ","      switch (command) {","        case 0x8: // Note Off","          message = `Note Off ch${channel} note=${data1}`;","          value = `vel=${data2}`;","          break;","        case 0x9: // Note On","          if (data2 === 0) {","            message = `Note Off ch${channel} note=${data1}`;","          } else {","            message = `Note On ch${channel} note=${data1}`;","            value = `vel=${data2}`;","          }","          break;","        case 0xA: // Aftertouch","          message = `Aftertouch ch${channel} note=${data1}`;","          value = data2;","          break;","        case 0xB: // Control Change","          message = `CC ch${channel} ctrl=${data1}`;","          value = data2;","          break;","        case 0xC: // Program Change","          message = `Program ch${channel}`;","          value = data1;","          break;","        case 0xD: // Channel Pressure","          message = `Pressure ch${channel}`;","          value = data1;","          break;","        case 0xE: // Pitch Bend","          const bend = ((data2 << 7) | data1) - 8192;","          message = `Pitch Bend ch${channel}`;","          value = bend;","          break;","        default:","          message = `Unknown [${Array.from(e.data).map(b => b.toString(16).padStart(2,'0')).join(' ')}]`;","      }","      ","      log('midi', message, value);","    }","    ","    // Gamepad","    function initGamepad() {","      window.addEventListener('gamepadconnected', (e) => {","        gamepads[e.gamepad.index] = e.gamepad;","        updateGamepadDevices();","        log('system', `Gamepad connected: ${e.gamepad.id}`);","      });","      ","      window.addEventListener('gamepaddisconnected', (e) => {","        delete gamepads[e.gamepad.index];","        delete lastGamepadState[e.gamepad.index];","        updateGamepadDevices();","        log('system', `Gamepad disconnected: ${e.gamepad.id}`);","      });","      ","      // Start polling","      requestAnimationFrame(pollGamepads);","    }","    ","    function updateGamepadDevices() {","      const pads = Object.values(gamepads);","      ","      if (pads.length === 0) {","        gamepadDevicesEl.innerHTML = '<div class=\"no-devices\">Press a button to connect</div>';","        gamepadVisualEl.style.display = 'none';","        return;","      }","      ","      gamepadDevicesEl.innerHTML = pads.map(gp => `","        <div class=\"device\">","          <span class=\"status-dot connected\"></span>","          <span class=\"name\">${gp.id.split('(')[0].trim()}</span>","          <div class=\"info\">${gp.buttons.length} buttons, ${gp.axes.length} axes</div>","        </div>","      `).join('');","      ","      gamepadVisualEl.style.display = 'grid';","    }","    ","    function pollGamepads() {","      const pads = navigator.getGamepads();","      ","      for (const gp of pads) {","        if (!gp) continue;","        ","        gamepads[gp.index] = gp;","        const last = lastGamepadState[gp.index] || { buttons: [], axes: [] };","        ","        // Check buttons","        gp.buttons.forEach((btn, i) => {","          const wasPressed = last.buttons[i]?.pressed || false;","          if (btn.pressed && !wasPressed) {","            log('gamepad', `Button ${i} pressed`, btn.value.toFixed(2));","          } else if (!btn.pressed && wasPressed) {","            log('gamepad', `Button ${i} released`);","          }","        });","        ","        // Check axes (only log significant changes)","        gp.axes.forEach((val, i) => {","          const lastVal = last.axes[i] || 0;","          if (Math.abs(val - lastVal) > 0.1) {","            // Only log when crossing thresholds","            if (Math.abs(val) > 0.5 || (Math.abs(lastVal) > 0.5 && Math.abs(val) < 0.2)) {","              log('gamepad', `Axis ${i}`, val.toFixed(2));","            }","          }","        });","        ","        // Save state","        lastGamepadState[gp.index] = {","          buttons: gp.buttons.map(b => ({ pressed: b.pressed, value: b.value })),","          axes: [...gp.axes]","        };","        ","        // Update visual","        updateGamepadVisual(gp);","      }","      ","      requestAnimationFrame(pollGamepads);","    }","    ","    function updateGamepadVisual(gp) {","      const buttons = gp.buttons.slice(0, 16);","      const axes = gp.axes.slice(0, 4);","      ","      gamepadVisualEl.innerHTML = `","        ${axes.map((v, i) => `","          <div class=\"axis-bar\" title=\"Axis ${i}\">","            <div class=\"fill\" style=\"left: ${50 + v * 50}%; width: ${Math.abs(v) * 50}%; ${v < 0 ? 'transform: translateX(-100%);' : ''}\"></div>","          </div>","        `).join('')}","        ${buttons.map((b, i) => `","          <div class=\"button-indicator ${b.pressed ? 'pressed' : ''}\" title=\"Button ${i}\">${i}</div>","        `).join('')}","      `;","    }","    ","    // Controls","    document.getElementById('requestMidi').addEventListener('click', initMidi);","    document.getElementById('clearLog').addEventListener('click', () => {","      events = [];","      renderLog();","    });","    ","    document.getElementById('pauseLog').addEventListener('click', (e) => {","      paused = !paused;","      e.target.textContent = paused ? 'Resume' : 'Pause';","      e.target.classList.toggle('active', paused);","    });","    ","    ['All', 'Midi', 'Gamepad'].forEach(f => {","      document.getElementById(`filter${f}`).addEventListener('click', (e) => {","        filter = f.toLowerCase();","        document.querySelectorAll('.log-controls button').forEach(b => b.classList.remove('active'));","        e.target.classList.add('active');","        renderLog();","      });","    });","    ","    // Session timer","    setInterval(() => {","      const elapsed = Math.floor((Date.now() - startTime) / 1000);","      const mins = Math.floor(elapsed / 60);","      const secs = elapsed % 60;","      sessionTimeEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;","    }, 1000);","    ","    // Init","    initMidi();","    initGamepad();","    log('system', 'Input Logger initialized');","  </script>","</body>","</html>",""]}