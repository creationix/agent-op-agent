{"type":"text","lines":["// Auto-reload when ref changes via SSE","(function() {","  // Extract ref from current URL path","  const path = window.location.pathname;","  const match = path.match(/^\\/?(refs\\/[^/]+\\/[^/]+)/);","  if (!match) {","    console.log('[auto-reload] No ref found in path, skipping');","    return;","  }","  ","  const ref = match[1];","  let currentHash = null;","  let reconnectDelay = 1000;","  ","  function connect() {","    const sseUrl = `/sse/${ref}`;","    console.log(`[auto-reload] Connecting to ${sseUrl}`);","    ","    const es = new EventSource(sseUrl);","    ","    es.onmessage = (event) => {","      try {","        const data = JSON.parse(event.data);","        console.log('[auto-reload] Received:', data);","        ","        if (currentHash === null) {","          // First message - store initial hash","          currentHash = data.hash;","          console.log('[auto-reload] Initial hash:', currentHash);","        } else if (data.hash !== currentHash) {","          // Hash changed - reload!","          console.log('[auto-reload] Hash changed, reloading...');","          window.location.reload();","        }","      } catch (e) {","        // Ignore parse errors (heartbeats)","      }","    };","    ","    es.onerror = () => {","      es.close();","      console.log(`[auto-reload] Connection lost, reconnecting in ${reconnectDelay}ms`);","      setTimeout(connect, reconnectDelay);","      reconnectDelay = Math.min(reconnectDelay * 1.5, 10000);","    };","    ","    es.onopen = () => {","      console.log('[auto-reload] Connected');","      reconnectDelay = 1000;","    };","  }","  ","  connect();","})();"]}